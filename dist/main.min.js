!function(){"use strict";const gt="137dev",q=0,j=1,Z=2,vt=1,Mt=2,H=0,Q=1,K=5,J=100,$=101,tt=102,et=103,it=104,rt=200,st=201,nt=202,at=203,ot=204,ht=205,lt=206,ut=207,ct=208,dt=209,pt=210,ft=0,mt=1,xt=2,yt=3,_t=4,wt=5,bt=6,St=7,At=1001,t=7680;class e{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)}removeEventListener(t,e){if(void 0!==this._listeners){const i=this._listeners[t];void 0===i||-1!==(e=i.indexOf(e))&&i.splice(e,1)}}dispatchEvent(i){if(void 0!==this._listeners){const t=this._listeners[i.type];if(void 0!==t){i.target=this;const r=t.slice(0);for(let t=0,e=r.length;t<e;t++)r[t].call(this,i);i.target=null}}}}const n=[];for(let t=0;t<256;t++)n[t]=(t<16?"0":"")+t.toString(16);const h=Math.PI/180,i=180/Math.PI;function u(){var t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0;const s=n[255&t]+n[t>>8&255]+n[t>>16&255]+n[t>>24&255]+"-"+n[255&e]+n[e>>8&255]+"-"+n[e>>16&15|64]+n[e>>24&255]+"-"+n[63&i|128]+n[i>>8&255]+"-"+n[i>>16&255]+n[i>>24&255]+n[255&r]+n[r>>8&255]+n[r>>16&255]+n[r>>24&255];return s.toUpperCase()}function d(t,e,i){return Math.max(e,Math.min(i,t))}class T{constructor(t=0,e=0){this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return void 0!==e?this.addVectors(t,e):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return void 0!==e?this.subVectors(t,e):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){var e=this.x,i=this.y,t=t.elements;return this.x=t[0]*e+t[3]*i+t[6],this.y=t[1]*e+t[4]*i+t[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){var e=this.x-t.x,t=this.y-t.y;return e*e+t*t}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,i){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){var i=Math.cos(e),r=Math.sin(e),s=this.x-t.x,e=this.y-t.y;return this.x=s*i-e*r+t.x,this.y=s*r+e*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}T.prototype.isVector2=!0;class y{constructor(){this.elements=[1,0,0,0,1,0,0,0,1]}set(t,e,i,r,s,n,a,o,h){const l=this.elements;return l[0]=t,l[1]=r,l[2]=a,l[3]=e,l[4]=s,l[5]=o,l[6]=i,l[7]=n,l[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements;t=t.elements;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){t=t.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){var i=t.elements,r=e.elements;const s=this.elements;var n=i[0],a=i[3],o=i[6],h=i[1],l=i[4],u=i[7],c=i[2],d=i[5],p=i[8],f=r[0],m=r[3],x=r[6],y=r[1],g=r[4],t=r[7],e=r[2],i=r[5],r=r[8];return s[0]=n*f+a*y+o*e,s[3]=n*m+a*g+o*i,s[6]=n*x+a*t+o*r,s[1]=h*f+l*y+u*e,s[4]=h*m+l*g+u*i,s[7]=h*x+l*t+u*r,s[2]=c*f+d*y+p*e,s[5]=c*m+d*g+p*i,s[8]=c*x+d*t+p*r,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){var t=this.elements,e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],a=t[5],o=t[6],h=t[7],t=t[8];return e*n*t-e*a*h-i*s*t+i*a*o+r*s*h-r*n*o}invert(){const t=this.elements,e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],a=t[5],o=t[6],h=t[7],l=t[8],u=l*n-a*h,c=a*o-l*s,d=h*s-n*o,p=e*u+i*c+r*d;if(0==p)return this.set(0,0,0,0,0,0,0,0,0);var f=1/p;return t[0]=u*f,t[1]=(r*h-l*i)*f,t[2]=(a*i-r*n)*f,t[3]=c*f,t[4]=(l*e-r*o)*f,t[5]=(r*s-a*e)*f,t[6]=d*f,t[7]=(i*o-h*e)*f,t[8]=(n*e-i*s)*f,this}transpose(){var t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,r,s,n,a){var o=Math.cos(s),s=Math.sin(s);return this.set(i*o,i*s,-i*(o*n+s*a)+n+t,-r*s,r*o,-r*(-s*n+o*a)+a+e,0,0,1),this}scale(t,e){const i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=e,i[4]*=e,i[7]*=e,this}rotate(t){var e=Math.cos(t),i=Math.sin(t);const r=this.elements;var s=r[0],n=r[3],a=r[6],o=r[1],h=r[4],t=r[7];return r[0]=e*s+i*o,r[3]=e*n+i*h,r[6]=e*a+i*t,r[1]=-i*s+e*o,r[4]=-i*n+e*h,r[7]=-i*a+e*t,this}translate(t,e){const i=this.elements;return i[0]+=t*i[2],i[3]+=t*i[5],i[6]+=t*i[8],i[1]+=e*i[2],i[4]+=e*i[5],i[7]+=e*i[8],this}equals(t){var e=this.elements,i=t.elements;for(let t=0;t<9;t++)if(e[t]!==i[t])return!1;return!0}fromArray(e,i=0){for(let t=0;t<9;t++)this.elements[t]=e[t+i];return this}toArray(t=[],e=0){var i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}y.prototype.isMatrix3=!0;let c=0;class p extends e{constructor(t=p.DEFAULT_IMAGE,e=p.DEFAULT_MAPPING,i=At,r=At,s=1006,n=1008,a=1023,o=1009,h=1,l=3e3){super(),Object.defineProperty(this,"id",{value:c++}),this.uuid=u(),this.name="",this.image=t,this.mipmaps=[],this.mapping=e,this.wrapS=i,this.wrapT=r,this.magFilter=s,this.minFilter=n,this.anisotropy=h,this.format=a,this.internalFormat=null,this.type=o,this.offset=new T(0,0),this.repeat=new T(1,1),this.center=new T(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new y,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=l,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||1<t.x)switch(this.wrapS){case 1e3:t.x=t.x-Math.floor(t.x);break;case At:t.x=t.x<0?0:1;break;case 1002:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||1<t.y)switch(this.wrapT){case 1e3:t.y=t.y-Math.floor(t.y);break;case At:t.y=t.y<0?0:1;break;case 1002:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&this.version++}}p.DEFAULT_IMAGE=void 0,p.DEFAULT_MAPPING=300,p.prototype.isTexture=!0;class zt{constructor(t=0,e=0,i=0,r=1){this.x=t,this.y=e,this.z=i,this.w=r}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,i,r){return this.x=t,this.y=e,this.z=i,this.w=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t,e){return void 0!==e?this.addVectors(t,e):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t,e){return void 0!==e?this.subVectors(t,e):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){var e=this.x,i=this.y,r=this.z,s=this.w,t=t.elements;return this.x=t[0]*e+t[4]*i+t[8]*r+t[12]*s,this.y=t[1]*e+t[5]*i+t[9]*r+t[13]*s,this.z=t[2]*e+t[6]*i+t[10]*r+t[14]*s,this.w=t[3]*e+t[7]*i+t[11]*r+t[15]*s,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,i,r,s;var n=t.elements,a=n[0],o=n[4],h=n[8],l=n[1],u=n[5],c=n[9],d=n[2],p=n[6],f=n[10];if(Math.abs(o-l)<.01&&Math.abs(h-d)<.01&&Math.abs(c-p)<.01){if(Math.abs(o+l)<.1&&Math.abs(h+d)<.1&&Math.abs(c+p)<.1&&Math.abs(a+u+f-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;var m=(a+1)/2,x=(u+1)/2,y=(f+1)/2,g=(o+l)/4,t=(h+d)/4,n=(c+p)/4;return x<m&&y<m?s=m<.01?(i=0,r=.707106781):(i=Math.sqrt(m),r=g/i,t/i):y<x?s=x<.01?(i=.707106781,r=0,.707106781):(r=Math.sqrt(x),i=g/r,n/r):y<.01?(i=.707106781,r=.707106781,s=0):(s=Math.sqrt(y),i=t/s,r=n/s),this.set(i,r,s,e),this}let v=Math.sqrt((p-c)*(p-c)+(h-d)*(h-d)+(l-o)*(l-o));return Math.abs(v)<.001&&(v=1),this.x=(p-c)/v,this.y=(h-d)/v,this.z=(l-o)/v,this.w=Math.acos((a+u+f-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e,i){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}zt.prototype.isVector4=!0;class Et extends e{constructor(t,e,i={}){super(),this.width=t,this.height=e,this.depth=1,this.scissor=new zt(0,0,t,e),this.scissorTest=!1,this.viewport=new zt(0,0,t,e),this.texture=new p(void 0,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.image={width:t,height:e,depth:1},this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.internalFormat=void 0!==i.internalFormat?i.internalFormat:null,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:1006,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null}setTexture(t){t.image={width:this.width,height:this.height,depth:this.depth},this.texture=t}setSize(t,e,i=1){this.width===t&&this.height===e&&this.depth===i||(this.width=t,this.height=e,this.depth=i,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.image=Object.assign({},t.texture.image),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}Et.prototype.isWebGLRenderTarget=!0;class Tt extends Et{constructor(t,e,i={}){super(t,e,i),this.samples=4,this.ignoreDepthForMultisampleCopy=void 0===i.ignoreDepth||i.ignoreDepth,this.useRenderToTexture=void 0!==i.useRenderToTexture&&i.useRenderToTexture,this.useRenderbuffer=!1===this.useRenderToTexture}copy(t){return super.copy.call(this,t),this.samples=t.samples,this.useRenderToTexture=t.useRenderToTexture,this.useRenderbuffer=t.useRenderbuffer,this}}Tt.prototype.isWebGLMultisampleRenderTarget=!0;class s{constructor(t=0,e=0,i=0,r=1){this._x=t,this._y=e,this._z=i,this._w=r}static slerp(t,e,i,r){return i.slerpQuaternions(t,e,r)}static slerpFlat(t,e,i,r,s,n,a){let o=i[r+0],h=i[r+1],l=i[r+2],u=i[r+3];var c=s[n+0],d=s[n+1],p=s[n+2],i=s[n+3];if(0===a)return t[e+0]=o,t[e+1]=h,t[e+2]=l,void(t[e+3]=u);if(1===a)return t[e+0]=c,t[e+1]=d,t[e+2]=p,void(t[e+3]=i);if(u!==i||o!==c||h!==d||l!==p){let t=1-a;var r=o*c+h*d+l*p+u*i,s=0<=r?1:-1,n=1-r*r;n>Number.EPSILON&&(n=Math.sqrt(n),r=Math.atan2(n,r*s),t=Math.sin(t*r)/n,a=Math.sin(a*r)/n);s=a*s;o=o*t+c*s,h=h*t+d*s,l=l*t+p*s,u=u*t+i*s,t===1-a&&(a=1/Math.sqrt(o*o+h*h+l*l+u*u),o*=a,h*=a,l*=a,u*=a)}t[e]=o,t[e+1]=h,t[e+2]=l,t[e+3]=u}static multiplyQuaternionsFlat(t,e,i,r,s,n){var a=i[r],o=i[r+1],h=i[r+2],l=i[r+3],u=s[n],i=s[n+1],r=s[n+2],n=s[n+3];return t[e]=a*n+l*u+o*r-h*i,t[e+1]=o*n+l*i+h*u-a*r,t[e+2]=h*n+l*r+a*i-o*u,t[e+3]=l*n-a*u-o*i-h*r,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,r){return this._x=t,this._y=e,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("");var i=t._x,r=t._y,s=t._z,t=t._order;const n=Math.cos,a=Math.sin;var o=n(i/2),h=n(r/2),l=n(s/2),u=a(i/2),c=a(r/2),d=a(s/2);switch(t){case"XYZ":this._x=u*h*l+o*c*d,this._y=o*c*l-u*h*d,this._z=o*h*d+u*c*l,this._w=o*h*l-u*c*d;break;case"YXZ":this._x=u*h*l+o*c*d,this._y=o*c*l-u*h*d,this._z=o*h*d-u*c*l,this._w=o*h*l+u*c*d;break;case"ZXY":this._x=u*h*l-o*c*d,this._y=o*c*l+u*h*d,this._z=o*h*d+u*c*l,this._w=o*h*l-u*c*d;break;case"ZYX":this._x=u*h*l-o*c*d,this._y=o*c*l+u*h*d,this._z=o*h*d-u*c*l,this._w=o*h*l+u*c*d;break;case"YZX":this._x=u*h*l+o*c*d,this._y=o*c*l+u*h*d,this._z=o*h*d-u*c*l,this._w=o*h*l-u*c*d;break;case"XZY":this._x=u*h*l-o*c*d,this._y=o*c*l-u*h*d,this._z=o*h*d+u*c*l,this._w=o*h*l+u*c*d}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){var i=e/2,e=Math.sin(i);return this._x=t.x*e,this._y=t.y*e,this._z=t.z*e,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){var e,i=t.elements,r=i[0],s=i[4],n=i[8],a=i[1],o=i[5],h=i[9],l=i[2],u=i[6],t=i[10],i=r+o+t;return 0<i?(i=.5/Math.sqrt(i+1),this._w=.25/i,this._x=(u-h)*i,this._y=(n-l)*i,this._z=(a-s)*i):o<r&&t<r?(e=2*Math.sqrt(1+r-o-t),this._w=(u-h)/e,this._x=.25*e,this._y=(s+a)/e,this._z=(n+l)/e):t<o?(e=2*Math.sqrt(1+o-r-t),this._w=(n-l)/e,this._x=(s+a)/e,this._y=.25*e,this._z=(h+u)/e):(o=2*Math.sqrt(1+t-r-o),this._w=(a-s)/o,this._x=(n+l)/o,this._y=(h+u)/o,this._z=.25*o),this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0):(this._x=0,this._y=-t.z,this._z=t.y)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x),this._w=i,this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(d(this.dot(t),-1,1)))}rotateTowards(t,e){var i=this.angleTo(t);if(0===i)return this;i=Math.min(1,e/i);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(this._x=this._x*(t=1/t),this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?this.multiplyQuaternions(t,e):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){var i=t._x,r=t._y,s=t._z,n=t._w,a=e._x,o=e._y,t=e._z,e=e._w;return this._x=i*e+n*a+r*t-s*o,this._y=r*e+n*o+s*a-i*t,this._z=s*e+n*t+i*o-r*a,this._w=n*e-i*a-r*o-s*t,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);var i=this._x,r=this._y,s=this._z,n=this._w;let a=n*t._w+i*t._x+r*t._y+s*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),1<=a)return this._w=n,this._x=i,this._y=r,this._z=s,this;var o=1-a*a;if(o<=Number.EPSILON){var h=1-e;return this._w=h*n+e*this._w,this._x=h*i+e*this._x,this._y=h*r+e*this._y,this._z=h*s+e*this._z,this.normalize(),this._onChangeCallback(),this}t=Math.sqrt(o),h=Math.atan2(t,a),o=Math.sin((1-e)*h)/t,t=Math.sin(e*h)/t;return this._w=n*o+this._w*t,this._x=i*o+this._x*t,this._y=r*o+this._y*t,this._z=s*o+this._z*t,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){var t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),r=2*Math.PI*Math.random(),t=2*Math.PI*Math.random();return this.set(e*Math.cos(r),i*Math.sin(t),i*Math.cos(t),e*Math.sin(r))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}s.prototype.isQuaternion=!0;class Ct{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}set(t,e,i){return void 0===i&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return void 0!==e?this.addVectors(t,e):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return void 0!==e?this.subVectors(t,e):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return void 0!==e?this.multiplyVectors(t,e):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler,this.applyQuaternion(a.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(a.setFromAxisAngle(t,e))}applyMatrix3(t){var e=this.x,i=this.y,r=this.z,t=t.elements;return this.x=t[0]*e+t[3]*i+t[6]*r,this.y=t[1]*e+t[4]*i+t[7]*r,this.z=t[2]*e+t[5]*i+t[8]*r,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){var e=this.x,i=this.y,r=this.z,s=t.elements,t=1/(s[3]*e+s[7]*i+s[11]*r+s[15]);return this.x=(s[0]*e+s[4]*i+s[8]*r+s[12])*t,this.y=(s[1]*e+s[5]*i+s[9]*r+s[13])*t,this.z=(s[2]*e+s[6]*i+s[10]*r+s[14])*t,this}applyQuaternion(t){var e=this.x,i=this.y,r=this.z,s=t.x,n=t.y,a=t.z,o=t.w,h=o*e+n*r-a*i,l=o*i+a*e-s*r,t=o*r+s*i-n*e,r=-s*e-n*i-a*r;return this.x=h*o+r*-s+l*-a-t*-n,this.y=l*o+r*-n+t*-s-h*-a,this.z=t*o+r*-a+h*-n-l*-s,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){var e=this.x,i=this.y,r=this.z,t=t.elements;return this.x=t[0]*e+t[4]*i+t[8]*r,this.y=t[1]*e+t[5]*i+t[9]*r,this.z=t[2]*e+t[6]*i+t[10]*r,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t,e){return void 0!==e?this.crossVectors(t,e):this.crossVectors(this,t)}crossVectors(t,e){var i=t.x,r=t.y,s=t.z,n=e.x,t=e.y,e=e.z;return this.x=r*e-s*t,this.y=s*n-i*e,this.z=i*t-r*n,this}projectOnVector(t){var e=t.lengthSq();if(0===e)return this.set(0,0,0);e=t.dot(this)/e;return this.copy(t).multiplyScalar(e)}projectOnPlane(t){return r.copy(this).projectOnVector(t),this.sub(r)}reflect(t){return this.sub(r.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){var e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;e=this.dot(t)/e;return Math.acos(d(e,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){var e=this.x-t.x,i=this.y-t.y,t=this.z-t.z;return e*e+i*i+t*t}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){var r=Math.sin(e)*t;return this.x=r*Math.sin(i),this.y=Math.cos(e)*t,this.z=r*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){t=t.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(t){var e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),t=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=t,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,i){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){var t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}Ct.prototype.isVector3=!0;const r=new Ct,a=new s;class Ft{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(t,e,i,r,s,n,a,o,h,l,u,c,d,p,f,m){const x=this.elements;return x[0]=t,x[4]=e,x[8]=i,x[12]=r,x[1]=s,x[5]=n,x[9]=a,x[13]=o,x[2]=h,x[6]=l,x[10]=u,x[14]=c,x[3]=d,x[7]=p,x[11]=f,x[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Ft).fromArray(this.elements)}copy(t){const e=this.elements;t=t.elements;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){t=t.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements;var i=t.elements,r=1/l.setFromMatrixColumn(t,0).length(),s=1/l.setFromMatrixColumn(t,1).length(),t=1/l.setFromMatrixColumn(t,2).length();return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=0,e[4]=i[4]*s,e[5]=i[5]*s,e[6]=i[6]*s,e[7]=0,e[8]=i[8]*t,e[9]=i[9]*t,e[10]=i[10]*t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler;const e=this.elements;var i,r,s,n,a,o,h,l,u,c,d,p=t.x,f=t.y,m=t.z,x=Math.cos(p),y=Math.sin(p),g=Math.cos(f),v=Math.sin(f),p=Math.cos(m),f=Math.sin(m);return"XYZ"===t.order?(i=x*p,s=x*f,r=y*p,m=y*f,e[0]=g*p,e[4]=-g*f,e[8]=v,e[1]=s+r*v,e[5]=i-m*v,e[9]=-y*g,e[2]=m-i*v,e[6]=r+s*v,e[10]=x*g):"YXZ"===t.order?(n=g*p,i=g*f,r=v*p,s=v*f,e[0]=n+s*y,e[4]=r*y-i,e[8]=x*v,e[1]=x*f,e[5]=x*p,e[9]=-y,e[2]=i*y-r,e[6]=s+n*y,e[10]=x*g):"ZXY"===t.order?(h=g*p,n=g*f,a=v*p,o=v*f,e[0]=h-o*y,e[4]=-x*f,e[8]=a+n*y,e[1]=n+a*y,e[5]=x*p,e[9]=o-h*y,e[2]=-x*v,e[6]=y,e[10]=x*g):"ZYX"===t.order?(a=x*p,o=x*f,l=y*p,h=y*f,e[0]=g*p,e[4]=l*v-o,e[8]=a*v+h,e[1]=g*f,e[5]=h*v+a,e[9]=o*v-l,e[2]=-v,e[6]=y*g,e[10]=x*g):"YZX"===t.order?(c=x*g,l=x*v,u=y*g,d=y*v,e[0]=g*p,e[4]=d-c*f,e[8]=u*f+l,e[1]=f,e[5]=x*p,e[9]=-y*p,e[2]=-v*p,e[6]=l*f+u,e[10]=c-d*f):"XZY"===t.order&&(u=x*g,c=x*v,d=y*g,t=y*v,e[0]=g*p,e[4]=-f,e[8]=v*p,e[1]=u*f+t,e[5]=x*p,e[9]=c*f-d,e[2]=d*f-c,e[6]=y*p,e[10]=t*f+u),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(o,t,m)}lookAt(t,e,i){const r=this.elements;return v.subVectors(t,e),0===v.lengthSq()&&(v.z=1),v.normalize(),x.crossVectors(i,v),0===x.lengthSq()&&(1===Math.abs(i.z)?v.x+=1e-4:v.z+=1e-4,v.normalize(),x.crossVectors(i,v)),x.normalize(),g.crossVectors(v,x),r[0]=x.x,r[4]=g.x,r[8]=v.x,r[1]=x.y,r[5]=g.y,r[9]=v.y,r[2]=x.z,r[6]=g.z,r[10]=v.z,this}multiply(t,e){return void 0!==e?this.multiplyMatrices(t,e):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){var i=t.elements,r=e.elements;const s=this.elements;var n=i[0],a=i[4],o=i[8],h=i[12],l=i[1],u=i[5],c=i[9],d=i[13],p=i[2],f=i[6],m=i[10],x=i[14],y=i[3],g=i[7],v=i[11],M=i[15],_=r[0],w=r[4],b=r[8],S=r[12],A=r[1],z=r[5],E=r[9],T=r[13],C=r[2],F=r[6],L=r[10],R=r[14],t=r[3],e=r[7],i=r[11],r=r[15];return s[0]=n*_+a*A+o*C+h*t,s[4]=n*w+a*z+o*F+h*e,s[8]=n*b+a*E+o*L+h*i,s[12]=n*S+a*T+o*R+h*r,s[1]=l*_+u*A+c*C+d*t,s[5]=l*w+u*z+c*F+d*e,s[9]=l*b+u*E+c*L+d*i,s[13]=l*S+u*T+c*R+d*r,s[2]=p*_+f*A+m*C+x*t,s[6]=p*w+f*z+m*F+x*e,s[10]=p*b+f*E+m*L+x*i,s[14]=p*S+f*T+m*R+x*r,s[3]=y*_+g*A+v*C+M*t,s[7]=y*w+g*z+v*F+M*e,s[11]=y*b+g*E+v*L+M*i,s[15]=y*S+g*T+v*R+M*r,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){var t=this.elements,e=t[0],i=t[4],r=t[8],s=t[12],n=t[1],a=t[5],o=t[9],h=t[13],l=t[2],u=t[6],c=t[10],d=t[14];return t[3]*(+s*o*u-r*h*u-s*a*c+i*h*c+r*a*d-i*o*d)+t[7]*(+e*o*d-e*h*c+s*n*c-r*n*d+r*h*l-s*o*l)+t[11]*(+e*h*u-e*a*d-s*n*u+i*n*d+s*a*l-i*h*l)+t[15]*(-r*a*l-e*o*u+e*a*c+r*n*u-i*n*c+i*o*l)}transpose(){const t=this.elements;var e=t[1];return t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],a=t[5],o=t[6],h=t[7],l=t[8],u=t[9],c=t[10],d=t[11],p=t[12],f=t[13],m=t[14],x=t[15],y=u*m*h-f*c*h+f*o*d-a*m*d-u*o*x+a*c*x,g=p*c*h-l*m*h-p*o*d+n*m*d+l*o*x-n*c*x,v=l*f*h-p*u*h+p*a*d-n*f*d-l*a*x+n*u*x,M=p*u*o-l*f*o-p*a*c+n*f*c+l*a*m-n*u*m;var _=e*y+i*g+r*v+s*M;if(0==_)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);_=1/_;return t[0]=y*_,t[1]=(f*c*s-u*m*s-f*r*d+i*m*d+u*r*x-i*c*x)*_,t[2]=(a*m*s-f*o*s+f*r*h-i*m*h-a*r*x+i*o*x)*_,t[3]=(u*o*s-a*c*s-u*r*h+i*c*h+a*r*d-i*o*d)*_,t[4]=g*_,t[5]=(l*m*s-p*c*s+p*r*d-e*m*d-l*r*x+e*c*x)*_,t[6]=(p*o*s-n*m*s-p*r*h+e*m*h+n*r*x-e*o*x)*_,t[7]=(n*c*s-l*o*s+l*r*h-e*c*h-n*r*d+e*o*d)*_,t[8]=v*_,t[9]=(p*u*s-l*f*s-p*i*d+e*f*d+l*i*x-e*u*x)*_,t[10]=(n*f*s-p*a*s+p*i*h-e*f*h-n*i*x+e*a*x)*_,t[11]=(l*a*s-n*u*s-l*i*h+e*u*h+n*i*d-e*a*d)*_,t[12]=M*_,t[13]=(l*f*r-p*u*r+p*i*c-e*f*c-l*i*m+e*u*m)*_,t[14]=(p*a*r-n*f*r-p*i*o+e*f*o+n*i*m-e*a*m)*_,t[15]=(n*u*r-l*a*r+l*i*o-e*u*o-n*i*c+e*a*c)*_,this}scale(t){const e=this.elements;var i=t.x,r=t.y,t=t.z;return e[0]*=i,e[4]*=r,e[8]*=t,e[1]*=i,e[5]*=r,e[9]*=t,e[2]*=i,e[6]*=r,e[10]*=t,e[3]*=i,e[7]*=r,e[11]*=t,this}getMaxScaleOnAxis(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],t=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,t))}makeTranslation(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){var e=Math.cos(t),t=Math.sin(t);return this.set(1,0,0,0,0,e,-t,0,0,t,e,0,0,0,0,1),this}makeRotationY(t){var e=Math.cos(t),t=Math.sin(t);return this.set(e,0,t,0,0,1,0,0,-t,0,e,0,0,0,0,1),this}makeRotationZ(t){var e=Math.cos(t),t=Math.sin(t);return this.set(e,-t,0,0,t,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){var i=Math.cos(e),r=Math.sin(e),s=1-i,n=t.x,a=t.y,o=t.z,e=s*n,t=s*a;return this.set(e*n+i,e*a-r*o,e*o+r*a,0,e*a+r*o,t*a+i,t*o-r*n,0,e*o-r*a,t*o+r*n,s*o*o+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,r,s,n){return this.set(1,i,s,0,t,1,n,0,e,r,1,0,0,0,0,1),this}compose(t,e,i){const r=this.elements;var s=e._x,n=e._y,a=e._z,o=e._w,h=s+s,l=n+n,u=a+a,c=s*h,d=s*l,p=s*u,e=n*l,s=n*u,n=a*u,a=o*h,h=o*l,l=o*u,o=i.x,u=i.y,i=i.z;return r[0]=(1-(e+n))*o,r[1]=(d+l)*o,r[2]=(p-h)*o,r[3]=0,r[4]=(d-l)*u,r[5]=(1-(c+n))*u,r[6]=(s+a)*u,r[7]=0,r[8]=(p+h)*i,r[9]=(s-a)*i,r[10]=(1-(c+e))*i,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this}decompose(t,e,i){var r=this.elements;let s=l.set(r[0],r[1],r[2]).length();var n=l.set(r[4],r[5],r[6]).length(),a=l.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),t.x=r[12],t.y=r[13],t.z=r[14],f.copy(this);var o=1/s,t=1/n,r=1/a;return f.elements[0]*=o,f.elements[1]*=o,f.elements[2]*=o,f.elements[4]*=t,f.elements[5]*=t,f.elements[6]*=t,f.elements[8]*=r,f.elements[9]*=r,f.elements[10]*=r,e.setFromRotationMatrix(f),i.x=s,i.y=n,i.z=a,this}makePerspective(t,e,i,r,s,n){const a=this.elements;var o=2*s/(i-r),h=(e+t)/(e-t),i=(i+r)/(i-r),r=-(n+s)/(n-s),n=-2*n*s/(n-s);return a[0]=2*s/(e-t),a[4]=0,a[8]=h,a[12]=0,a[1]=0,a[5]=o,a[9]=i,a[13]=0,a[2]=0,a[6]=0,a[10]=r,a[14]=n,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(t,e,i,r,s,n){const a=this.elements;var o=1/(e-t),h=1/(i-r),l=1/(n-s),t=(e+t)*o,r=(i+r)*h,s=(n+s)*l;return a[0]=2*o,a[4]=0,a[8]=0,a[12]=-t,a[1]=0,a[5]=2*h,a[9]=0,a[13]=-r,a[2]=0,a[6]=0,a[10]=-2*l,a[14]=-s,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(t){var e=this.elements,i=t.elements;for(let t=0;t<16;t++)if(e[t]!==i[t])return!1;return!0}fromArray(e,i=0){for(let t=0;t<16;t++)this.elements[t]=e[t+i];return this}toArray(t=[],e=0){var i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}Ft.prototype.isMatrix4=!0;const l=new Ct,f=new Ft,o=new Ct(0,0,0),m=new Ct(1,1,1),x=new Ct,g=new Ct,v=new Ct;function Lt(){let i=null,t=!1,r=null,s=null;function n(t,e){r(t,e),s=i.requestAnimationFrame(n)}return{start:function(){!0!==t&&null!==r&&(s=i.requestAnimationFrame(n),t=!0)},stop:function(){i.cancelAnimationFrame(s),t=!1},setAnimationLoop:function(t){r=t},setContext:function(t){i=t}}}function Rt(a,t){const o=t.isWebGL2,s=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),s.get(t)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);var e=s.get(t);e&&(a.deleteBuffer(e.buffer),s.delete(t))},update:function(t,e){if(t.isGLBufferAttribute){var i=s.get(t);(!i||i.version<t.version)&&s.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version})}else{t.isInterleavedBufferAttribute&&(t=t.data);const r=s.get(t);void 0===r?s.set(t,function(t,e){var i=t.array,r=t.usage,s=a.createBuffer();a.bindBuffer(e,s),a.bufferData(e,i,r),t.onUploadCallback();let n=a.FLOAT;return i instanceof Float32Array?n=a.FLOAT:i instanceof Float64Array||(i instanceof Uint16Array?t.isFloat16BufferAttribute?o&&(n=a.HALF_FLOAT):n=a.UNSIGNED_SHORT:i instanceof Int16Array?n=a.SHORT:i instanceof Uint32Array?n=a.UNSIGNED_INT:i instanceof Int32Array?n=a.INT:i instanceof Int8Array?n=a.BYTE:(i instanceof Uint8Array||i instanceof Uint8ClampedArray)&&(n=a.UNSIGNED_BYTE)),{buffer:s,type:n,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version}}(t,e)):r.version<t.version&&(function(t,e,i){const r=e.array,s=e.updateRange;a.bindBuffer(i,t),-1===s.count?a.bufferSubData(i,0,r):(o?a.bufferSubData(i,s.offset*r.BYTES_PER_ELEMENT,r,s.offset,s.count):a.bufferSubData(i,s.offset*r.BYTES_PER_ELEMENT,r.subarray(s.offset,s.offset+s.count)),s.count=-1)}(r.buffer,t,e),r.version=t.version)}}}}function Ot(s,n,i,t,e,r){let a=[0,0,0],o=!0===e?0:1;function h(t,e){i.buffers.color.setClear(t[0],t[1],t[2],e,r)}return{getClearColor:function(){return a},setClearColor:function(t,e=1){a=t,o=e,h(a,o)},getClearAlpha:function(){return o},setClearAlpha:function(t){o=t,h(a,o)},render:function(t,e){let i=!1,r=!0===e.isScene?e.background:null;r&&r.isTexture&&(r=n.get(r)),null===r?h(a,o):r&&r.isColor&&(h(r,1),i=!0),(s.autoClear||i)&&s.clear(s.autoClearColor,s.autoClearDepth,s.autoClearStencil)}}}function Pt(v,a,M,o){const s=v.getParameter(v.MAX_VERTEX_ATTRIBS),h=o.isWebGL2?null:a.get("OES_vertex_array_object"),l=o.isWebGL2||null!==h,u={},t=p(null);let c=t;function d(t){return o.isWebGL2?v.bindVertexArray(t):h.bindVertexArrayOES(t)}function n(t){return o.isWebGL2?v.deleteVertexArray(t):h.deleteVertexArrayOES(t)}function p(t){const e=[],i=[],r=[];for(let t=0;t<s;t++)e[t]=0,i[t]=0,r[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:i,attributeDivisors:r,object:t,attributes:{},index:null}}function _(){const i=c.newAttributes;for(let t=0,e=i.length;t<e;t++)i[t]=0}function w(t){b(t,0)}function b(t,e){const i=c.newAttributes,r=c.enabledAttributes,s=c.attributeDivisors;if(i[t]=1,0===r[t]&&(v.enableVertexAttribArray(t),r[t]=1),s[t]!==e){const n=o.isWebGL2?v:a.get("ANGLE_instanced_arrays");n[o.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](t,e),s[t]=e}}function S(){var i=c.newAttributes;const r=c.enabledAttributes;for(let t=0,e=r.length;t<e;t++)r[t]!==i[t]&&(v.disableVertexAttribArray(t),r[t]=0)}function A(t,e,i,r,s,n){!0!==o.isWebGL2||i!==v.INT&&i!==v.UNSIGNED_INT?v.vertexAttribPointer(t,e,i,r,s,n):v.vertexAttribIPointer(t,e,i,s,n)}function f(){e(),c!==t&&(c=t,d(c.object))}function e(){t.geometry=null,t.program=null,t.wireframe=!1}return{setup:function(t,e,i,r,s){let n=!1;var a;l?(a=function(t,e,i){i=!0===i.wireframe;let r=u[t.id];void 0===r&&(r={},u[t.id]=r);let s=r[e.id];void 0===s&&(s={},r[e.id]=s);let n=s[i];void 0===n&&(n=p(o.isWebGL2?v.createVertexArray():h.createVertexArrayOES()),s[i]=n);return n}(r,i,e),c!==a&&(c=a,d(c.object)),n=function(t,e){var i=c.attributes,r=t.attributes;let s=0;for(const o in r){var n=i[o],a=r[o];if(void 0===n)return!0;if(n.attribute!==a)return!0;if(n.data!==a.data)return!0;s++}return c.attributesNum!==s||c.index!==e}(r,s),n&&function(t,e){const i={},r=t.attributes;let s=0;for(const a in r){var n=r[a];const o={};(o.attribute=n).data&&(o.data=n.data),i[a]=o,s++}c.attributes=i,c.attributesNum=s,c.index=e}(r,s)):(a=!0===e.wireframe,c.geometry===r.id&&c.program===i.id&&c.wireframe===a||(c.geometry=r.id,c.program=i.id,c.wireframe=a,n=!0)),null!==s&&M.update(s,v.ELEMENT_ARRAY_BUFFER),n&&(function(t,e,i,r){_();var s=r.attributes,n=i.getAttributes(),a=e.defaultAttributeValues;for(const g in n){var o=n[g];if(0<=o.location){let e=s[g];if(void 0===e&&("instanceMatrix"===g&&t.instanceMatrix&&(e=t.instanceMatrix),"instanceColor"===g&&t.instanceColor&&(e=t.instanceColor)),void 0!==e){var h=e.normalized,l=e.itemSize,u=M.get(e);if(void 0!==u){var c=u.buffer,d=u.type,p=u.bytesPerElement;if(e.isInterleavedBufferAttribute){var f=e.data,m=f.stride,x=e.offset;if(f&&f.isInstancedInterleavedBuffer)for(let t=0;t<o.locationSize;t++)b(o.location+t,f.meshPerAttribute);else for(let t=0;t<o.locationSize;t++)w(o.location+t);v.bindBuffer(v.ARRAY_BUFFER,c);for(let t=0;t<o.locationSize;t++)A(o.location+t,l/o.locationSize,d,h,m*p,(x+l/o.locationSize*t)*p)}else{if(e.isInstancedBufferAttribute)for(let t=0;t<o.locationSize;t++)b(o.location+t,e.meshPerAttribute);else for(let t=0;t<o.locationSize;t++)w(o.location+t);v.bindBuffer(v.ARRAY_BUFFER,c);for(let t=0;t<o.locationSize;t++)A(o.location+t,l/o.locationSize,d,h,l*p,l/o.locationSize*t*p)}}}else if(void 0!==a){var y=a[g];if(void 0!==y)switch(y.length){case 2:v.vertexAttrib2fv(o.location,y);break;case 3:v.vertexAttrib3fv(o.location,y);break;case 4:v.vertexAttrib4fv(o.location,y);break;default:v.vertexAttrib1fv(o.location,y)}}}}S()}(t,e,i,r),null!==s&&v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,M.get(s).buffer))},reset:f,resetDefaultState:e,dispose:function(){f();for(const t in u){const e=u[t];for(const i in e){const r=e[i];for(const s in r)n(r[s].object),delete r[s];delete e[i]}delete u[t]}},releaseStatesOfGeometry:function(t){if(void 0!==u[t.id]){const e=u[t.id];for(const i in e){const r=e[i];for(const s in r)n(r[s].object),delete r[s];delete e[i]}delete u[t.id]}},releaseStatesOfProgram:function(t){for(const e in u){const i=u[e];if(void 0!==i[t.id]){const r=i[t.id];for(const s in r)n(r[s].object),delete r[s];delete i[t.id]}}},initAttributes:_,enableAttribute:w,disableUnusedAttributes:S}}function It(n,a,o,t){const h=t.isWebGL2;let l;this.setMode=function(t){l=t},this.render=function(t,e){n.drawArrays(l,t,e),o.update(e,l,1)},this.renderInstances=function(i,r,s){if(0!==s){let t,e;if(h)t=n,e="drawArraysInstanced";else if(t=a.get("ANGLE_instanced_arrays"),e="drawArraysInstancedANGLE",null===t)return;t[e](l,i,r,s),o.update(r,l,s)}}}function Wt(e,i,t){let r;function s(t){if("highp"===t){if(0<e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision&&0<e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision)return"highp";t="mediump"}return"mediump"===t&&0<e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision&&0<e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision?"mediump":"lowp"}var n="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext;let a=void 0!==t.precision?t.precision:"highp";var o=s(a);o!==a&&(a=o);var h=n||i.has("WEBGL_draw_buffers"),l=!0===t.logarithmicDepthBuffer,u=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),c=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),d=e.getParameter(e.MAX_TEXTURE_SIZE),p=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),f=e.getParameter(e.MAX_VERTEX_ATTRIBS),m=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),x=e.getParameter(e.MAX_VARYING_VECTORS),y=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),g=0<c,v=n||i.has("OES_texture_float"),o=g&&v,t=n?e.getParameter(e.MAX_SAMPLES):0;return{isWebGL2:n,drawBuffers:h,getMaxAnisotropy:function(){return void 0!==r||(r=!0===i.has("EXT_texture_filter_anisotropic")?(t=i.get("EXT_texture_filter_anisotropic"),e.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT)):0),r;var t},getMaxPrecision:s,precision:a,logarithmicDepthBuffer:l,maxTextures:u,maxVertexTextures:c,maxTextureSize:d,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:x,maxFragmentUniforms:y,vertexTextures:g,floatFragmentTextures:v,floatVertexTextures:o,maxSamples:t}}const M=new Ct,_=new Ct,w=new y;class b{constructor(t=new Ct(1,0,0),e=0){this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,i,r){return this.normal.set(t,e,i),this.constant=r,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,i){e=M.subVectors(i,e).cross(_.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(e,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){var i=t.delta(M),r=this.normal.dot(i);if(0===r)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;r=-(t.start.dot(this.normal)+this.constant)/r;return r<0||1<r?null:e.copy(i).multiplyScalar(r).add(t.start)}intersectsLine(t){var e=this.distanceToPoint(t.start),t=this.distanceToPoint(t.end);return e<0&&0<t||t<0&&0<e}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){e=e||w.getNormalMatrix(t);const i=this.coplanarPoint(M).applyMatrix4(t);e=this.normal.applyMatrix3(e).normalize();return this.constant=-i.dot(e),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}function Bt(e){const o=this;let l=null,u=0,c=!1,d=!1;const h=new b,p=new y,f={value:null,needsUpdate:!1};function m(){f.value!==l&&(f.value=l,f.needsUpdate=0<u),o.numPlanes=u,o.numIntersection=0}function x(i,t,r,e){var s=null!==i?i.length:0;let n=null;if(0!==s){if(n=f.value,!0!==e||null===n){var e=r+4*s,a=t.matrixWorldInverse;p.getNormalMatrix(a),(null===n||n.length<e)&&(n=new Float32Array(e));for(let t=0,e=r;t!==s;++t,e+=4)h.copy(i[t]).applyMatrix4(a,p),h.normal.toArray(n,e),n[e+3]=h.constant}f.value=n,f.needsUpdate=!0}return o.numPlanes=s,o.numIntersection=0,n}this.uniform=f,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e,i){var r=0!==t.length||e||0!==u||c;return c=e,l=x(t,i,0),u=t.length,r},this.beginShadows=function(){d=!0,x(null)},this.endShadows=function(){d=!1,m()},this.setState=function(t,i,r){var s=t.clippingPlanes,n=t.clipIntersection,a=t.clipShadows;const o=e.get(t);if(!c||null===s||0===s.length||d&&!a)d?x(null):m();else{var a=d?0:u,h=4*a;let e=o.clippingState||null;f.value=e,e=x(s,i,h,r);for(let t=0;t!==h;++t)e[t]=l[t];o.clippingState=e,this.numIntersection=n?this.numPlanes:0,this.numPlanes+=a}}}function Dt(i){const r={};function e(t){if(void 0!==r[t])return r[t];let e;switch(t){case"WEBGL_depth_texture":e=i.getExtension("WEBGL_depth_texture")||i.getExtension("MOZ_WEBGL_depth_texture")||i.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":e=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":e=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":e=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:e=i.getExtension(t)}return r[t]=e,e}return{has:function(t){return null!==e(t)},init:function(t){t.isWebGL2?e("EXT_color_buffer_float"):(e("WEBGL_depth_texture"),e("OES_texture_float"),e("OES_texture_half_float"),e("OES_texture_half_float_linear"),e("OES_standard_derivatives"),e("OES_element_index_uint"),e("OES_vertex_array_object"),e("ANGLE_instanced_arrays")),e("OES_texture_float_linear"),e("EXT_color_buffer_half_float"),e("WEBGL_multisampled_render_to_texture")},get:function(t){t=e(t);return t}}}b.prototype.isPlane=!0;const S=new Ct,A=new T;class C{constructor(t,e,i){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===i,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(i,r,s){i*=this.itemSize,s*=r.itemSize;for(let t=0,e=this.itemSize;t<e;t++)this.array[i+t]=r.array[s+t];return this}copyArray(t){return this.array.set(t),this}copyVector2sArray(i){const r=this.array;let s=0;for(let e=0,t=i.length;e<t;e++){let t=i[e];void 0===t&&(t=new T),r[s++]=t.x,r[s++]=t.y}return this}copyVector3sArray(i){const r=this.array;let s=0;for(let e=0,t=i.length;e<t;e++){let t=i[e];void 0===t&&(t=new Ct),r[s++]=t.x,r[s++]=t.y,r[s++]=t.z}return this}copyVector4sArray(i){const r=this.array;let s=0;for(let e=0,t=i.length;e<t;e++){let t=i[e];void 0===t&&(t=new zt),r[s++]=t.x,r[s++]=t.y,r[s++]=t.z,r[s++]=t.w}return this}applyMatrix3(i){if(2===this.itemSize)for(let t=0,e=this.count;t<e;t++)A.fromBufferAttribute(this,t),A.applyMatrix3(i),this.setXY(t,A.x,A.y);else if(3===this.itemSize)for(let t=0,e=this.count;t<e;t++)S.fromBufferAttribute(this,t),S.applyMatrix3(i),this.setXYZ(t,S.x,S.y,S.z);return this}applyMatrix4(i){for(let t=0,e=this.count;t<e;t++)S.x=this.getX(t),S.y=this.getY(t),S.z=this.getZ(t),S.applyMatrix4(i),this.setXYZ(t,S.x,S.y,S.z);return this}applyNormalMatrix(i){for(let t=0,e=this.count;t<e;t++)S.x=this.getX(t),S.y=this.getY(t),S.z=this.getZ(t),S.applyNormalMatrix(i),this.setXYZ(t,S.x,S.y,S.z);return this}transformDirection(i){for(let t=0,e=this.count;t<e;t++)S.x=this.getX(t),S.y=this.getY(t),S.z=this.getZ(t),S.transformDirection(i),this.setXYZ(t,S.x,S.y,S.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){return this.array[t*this.itemSize]}setX(t,e){return this.array[t*this.itemSize]=e,this}getY(t){return this.array[t*this.itemSize+1]}setY(t,e){return this.array[t*this.itemSize+1]=e,this}getZ(t){return this.array[t*this.itemSize+2]}setZ(t,e){return this.array[t*this.itemSize+2]=e,this}getW(t){return this.array[t*this.itemSize+3]}setW(t,e){return this.array[t*this.itemSize+3]=e,this}setXY(t,e,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this}setXYZ(t,e,i,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=r,this}setXYZW(t,e,i,r,s){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=r,this.array[t+3]=s,this}onUpload(t){return this.onUploadCallback=t,this}}C.prototype.isBufferAttribute=!0;class z extends C{constructor(t,e,i){super(new Uint16Array(t),e,i)}}class E extends C{constructor(t,e,i){super(new Uint32Array(t),e,i)}}(class extends C{});class P extends C{constructor(t,e,i){super(new Float32Array(t),e,i)}}function F(i){if(0===i.length)return-1/0;let r=i[0];for(let t=1,e=i.length;t<e;++t)i[t]>r&&(r=i[t]);return r}function Ut(a,f,r,s){const n={},m=new WeakMap;function o(t){const e=t.target;null!==e.index&&f.remove(e.index);for(const i in e.attributes)f.remove(e.attributes[i]);e.removeEventListener("dispose",o),delete n[e.id];t=m.get(e);t&&(f.remove(t),m.delete(e)),s.releaseStatesOfGeometry(e),!0===e.isInstancedBufferGeometry&&delete e._maxInstanceCount,r.memory.geometries--}function h(t){const i=[];var e=t.index,r=t.attributes.position;let s=0;if(null!==e){var n=e.array;s=e.version;for(let t=0,e=n.length;t<e;t+=3){var a=n[t+0],o=n[t+1],h=n[t+2];i.push(a,o,o,h,h,a)}}else{var l=r.array;s=r.version;for(let t=0,e=l.length/3-1;t<e;t+=3){var u=t+0,c=t+1,d=t+2;i.push(u,c,c,d,d,u)}}const p=new(65535<F(i)?E:z)(i,1);p.version=s;l=m.get(t);l&&f.remove(l),m.set(t,p)}return{get:function(t,e){return!0===n[e.id]||(e.addEventListener("dispose",o),n[e.id]=!0,r.memory.geometries++),e},update:function(t){var e=t.attributes;for(const s in e)f.update(e[s],a.ARRAY_BUFFER);var i=t.morphAttributes;for(const n in i){var r=i[n];for(let t=0,e=r.length;t<e;t++)f.update(r[t],a.ARRAY_BUFFER)}},getWireframeAttribute:function(t){var e,i=m.get(t);return(!i||null!==(e=t.index)&&i.version<e.version)&&h(t),m.get(t)}}}function Nt(n,a,o,t){const h=t.isWebGL2;let l;let u,c;this.setMode=function(t){l=t},this.setIndex=function(t){u=t.type,c=t.bytesPerElement},this.render=function(t,e){n.drawElements(l,e,u,t*c),o.update(e,l,1)},this.renderInstances=function(i,r,s){if(0!==s){let t,e;if(h)t=n,e="drawElementsInstanced";else if(t=a.get("ANGLE_instanced_arrays"),e="drawElementsInstancedANGLE",null===t)return;t[e](l,r,u,i*c,s),o.update(r,l,s)}}}function kt(r){const s={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:s,programs:null,autoReset:!0,reset:function(){s.frame++,s.calls=0,s.triangles=0,s.points=0,s.lines=0},update:function(t,e,i){switch(s.calls++,e){case r.TRIANGLES:s.triangles+=i*(t/3);break;case r.LINES:s.lines+=i*(t/2);break;case r.LINE_STRIP:s.lines+=i*(t-1);break;case r.LINE_LOOP:s.lines+=i*t;break;case r.POINTS:s.points+=i*t}}}}function Vt(t,r,e,s){let n=new WeakMap;return{update:function(t){var e=s.render.frame,i=t.geometry,i=r.get(t,i);return n.get(i)!==e&&(r.update(i),n.set(i,e)),i},dispose:function(){n=new WeakMap}}}class L{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}isEnabled(t){return 0!=(this.mask&(1<<t|0))}}const R=new p,O=[],I=[],W=new Float32Array(16),B=new Float32Array(9),D=new Float32Array(4);function U(i,r,s){const t=i[0];if(t<=0||0<t)return i;var e=r*s;let n=O[e];if(void 0===n&&(n=new Float32Array(e),O[e]=n),0!==r){t.toArray(n,0);for(let t=1,e=0;t!==r;++t)e+=s,i[t].toArray(n,e)}return n}function N(i,r){if(i.length===r.length){for(let t=0,e=i.length;t<e;t++)if(i[t]!==r[t])return;return 1}}function k(i,r){for(let t=0,e=r.length;t<e;t++)i[t]=r[t]}function V(e,i){let r=I[i];void 0===r&&(r=new Int32Array(i),I[i]=r);for(let t=0;t!==i;++t)r[t]=e.allocateTextureUnit();return r}function X(t,e){const i=this.cache;i[0]!==e&&(t.uniform1f(this.addr,e),i[0]=e)}function G(t,e){const i=this.cache;void 0!==e.x?i[0]===e.x&&i[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y):N(i,e)||(t.uniform2fv(this.addr,e),k(i,e))}function Y(t,e){const i=this.cache;void 0!==e.x?i[0]===e.x&&i[1]===e.y&&i[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z):void 0!==e.r?i[0]===e.r&&i[1]===e.g&&i[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b):N(i,e)||(t.uniform3fv(this.addr,e),k(i,e))}function Xt(t,e){const i=this.cache;void 0!==e.x?i[0]===e.x&&i[1]===e.y&&i[2]===e.z&&i[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w):N(i,e)||(t.uniform4fv(this.addr,e),k(i,e))}function Gt(t,e){var i=this.cache,r=e.elements;void 0===r?N(i,e)||(t.uniformMatrix2fv(this.addr,!1,e),k(i,e)):N(i,r)||(D.set(r),t.uniformMatrix2fv(this.addr,!1,D),k(i,r))}function Yt(t,e){var i=this.cache,r=e.elements;void 0===r?N(i,e)||(t.uniformMatrix3fv(this.addr,!1,e),k(i,e)):N(i,r)||(B.set(r),t.uniformMatrix3fv(this.addr,!1,B),k(i,r))}function qt(t,e){var i=this.cache,r=e.elements;void 0===r?N(i,e)||(t.uniformMatrix4fv(this.addr,!1,e),k(i,e)):N(i,r)||(W.set(r),t.uniformMatrix4fv(this.addr,!1,W),k(i,r))}function jt(t,e){const i=this.cache;i[0]!==e&&(t.uniform1i(this.addr,e),i[0]=e)}function Zt(t,e){var i=this.cache;N(i,e)||(t.uniform2iv(this.addr,e),k(i,e))}function Ht(t,e){var i=this.cache;N(i,e)||(t.uniform3iv(this.addr,e),k(i,e))}function Qt(t,e){var i=this.cache;N(i,e)||(t.uniform4iv(this.addr,e),k(i,e))}function Kt(t,e){const i=this.cache;i[0]!==e&&(t.uniform1ui(this.addr,e),i[0]=e)}function Jt(t,e){var i=this.cache;N(i,e)||(t.uniform2uiv(this.addr,e),k(i,e))}function $t(t,e){var i=this.cache;N(i,e)||(t.uniform3uiv(this.addr,e),k(i,e))}function te(t,e){var i=this.cache;N(i,e)||(t.uniform4uiv(this.addr,e),k(i,e))}function ee(t,e,i){const r=this.cache;var s=i.allocateTextureUnit();r[0]!==s&&(t.uniform1i(this.addr,s),r[0]=s),i.safeSetTexture2D(e||R,s)}function ie(t,e){t.uniform1fv(this.addr,e)}function re(t,e){e=U(e,this.size,2);t.uniform2fv(this.addr,e)}function se(t,e){e=U(e,this.size,3);t.uniform3fv(this.addr,e)}function ne(t,e){e=U(e,this.size,4);t.uniform4fv(this.addr,e)}function ae(t,e){e=U(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,e)}function oe(t,e){e=U(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,e)}function he(t,e){e=U(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,e)}function le(t,e){t.uniform1iv(this.addr,e)}function ue(t,e){t.uniform2iv(this.addr,e)}function ce(t,e){t.uniform3iv(this.addr,e)}function de(t,e){t.uniform4iv(this.addr,e)}function pe(t,e){t.uniform1uiv(this.addr,e)}function fe(t,e){t.uniform2uiv(this.addr,e)}function me(t,e){t.uniform3uiv(this.addr,e)}function xe(t,e){t.uniform4uiv(this.addr,e)}function ye(t,e,i){var r=e.length,s=V(i,r);t.uniform1iv(this.addr,s);for(let t=0;t!==r;++t)i.safeSetTexture2D(e[t]||R,s[t])}function ge(t,e,i){var r=e.length,s=V(i,r);t.uniform1iv(this.addr,s);for(let t=0;t!==r;++t)i.setTexture3D(e[t]||emptyTexture3d,s[t])}function ve(t,e,i){var r=e.length,s=V(i,r);t.uniform1iv(this.addr,s);for(let t=0;t!==r;++t)i.safeSetTextureCube(e[t]||emptyCubeTexture,s[t])}function Me(t,e,i){var r=e.length,s=V(i,r);t.uniform1iv(this.addr,s);for(let t=0;t!==r;++t)i.setTexture2DArray(e[t]||emptyTexture2dArray,s[t])}function _e(t,e,i){this.id=t,this.addr=i,this.cache=[],this.setValue=function(t){switch(t){case 5126:return X;case 35664:return G;case 35665:return Y;case 35666:return Xt;case 35674:return Gt;case 35675:return Yt;case 35676:return qt;case 5124:case 35670:return jt;case 35667:case 35671:return Zt;case 35668:case 35672:return Ht;case 35669:case 35673:return Qt;case 5125:return Kt;case 36294:return Jt;case 36295:return $t;case 36296:return te;case 35678:case 36198:case 36298:case 36306:case 35682:return ee}}(e.type)}function we(t,e,i){this.id=t,this.addr=i,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return ie;case 35664:return re;case 35665:return se;case 35666:return ne;case 35674:return ae;case 35675:return oe;case 35676:return he;case 5124:case 35670:return le;case 35667:case 35671:return ue;case 35668:case 35672:return ce;case 35669:case 35673:return de;case 5125:return pe;case 36294:return fe;case 36295:return me;case 36296:return xe;case 35678:case 36198:case 36298:case 36306:case 35682:return ye;case 35679:case 36299:case 36307:return ge;case 35680:case 36300:case 36308:case 36293:return ve;case 36289:case 36303:case 36311:case 36292:return Me}}(e.type)}function be(t){this.id=t,this.seq=[],this.map={}}we.prototype.updateCache=function(t){var e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),k(e,t)},be.prototype.setValue=function(i,r,s){var n=this.seq;for(let t=0,e=n.length;t!==e;++t){const a=n[t];a.setValue(i,r[a.id],s)}};const Se=/(\w+)(\])?(\[|\.)?/g;function Ae(t,e){t.seq.push(e),t.map[e.id]=e}function ze(e,i){this.seq=[],this.map={};var r=e.getProgramParameter(i,e.ACTIVE_UNIFORMS);for(let t=0;t<r;++t){var s=e.getActiveUniform(i,t);!function(t,i,r){var s=t.name,n=s.length;for(Se.lastIndex=0;;){var a=Se.exec(s),o=Se.lastIndex;let e=a[1];var h="]"===a[2],a=a[3];if(h&&(e|=0),void 0===a||"["===a&&o+2===n){Ae(r,new(void 0===a?_e:we)(e,t,i));break}{let t=r.map[e];void 0===t&&(t=new be(e),Ae(r,t)),r=t}}}(s,e.getUniformLocation(i,s.name),this)}}function Ee(t,e,i){e=t.createShader(e);return t.shaderSource(e,i),t.compileShader(e),e}ze.prototype.setValue=function(t,e,i,r){const s=this.map[e];void 0!==s&&s.setValue(t,i,r)},ze.prototype.setOptional=function(t,e,i){e=e[i];void 0!==e&&this.setValue(t,i,e)},ze.upload=function(i,r,s,n){for(let t=0,e=r.length;t!==e;++t){const a=r[t],o=s[a.id];!1!==o.needsUpdate&&a.setValue(i,o.value,n)}},ze.seqWithValue=function(i,r){const s=[];for(let t=0,e=i.length;t!==e;++t){var n=i[t];n.id in r&&s.push(n)}return s};let Te=0;function Ce(t,e,i){var r=t.getShaderParameter(e,t.COMPILE_STATUS),s=t.getShaderInfoLog(e).trim();return r&&""===s?"":i.toUpperCase()+"\n\n"+s+"\n\n"+function(t){const e=t.split("\n");for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join("\n")}(t.getShaderSource(e))}function Fe(t){return""!==t}function Le(i,t,e,r){const s=i.getContext();var n=e.defines,a=e.vertexShader,o=e.fragmentShader;const h=e.isWebGL2?"":function(t){const e=[t.extensionDerivatives||t.envMapCubeUV||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""];return e.filter(Fe).join("\n")}(e),l=function(t){const e=[];for(const r in t){var i=t[r];!1!==i&&e.push("#define "+r+" "+i)}return e.join("\n")}(n),u=s.createProgram();let c,d;var p=e.glslVersion?"#version "+e.glslVersion+"\n":"";e.isRawShaderMaterial&&(c=[l].filter(Fe).join("\n"),0<c.length&&(c+="\n"),d=[h,l].filter(Fe).join("\n"),0<d.length&&(d+="\n"));n=p+c+a,a=p+d+o,p=Ee(s,s.VERTEX_SHADER,n),o=Ee(s,s.FRAGMENT_SHADER,a);if(s.attachShader(u,p),s.attachShader(u,o),void 0!==e.index0AttributeName?s.bindAttribLocation(u,0,e.index0AttributeName):!0===e.morphTargets&&s.bindAttribLocation(u,0,"position"),s.linkProgram(u),i.debug.checkShaderErrors){n=s.getProgramInfoLog(u).trim(),a=s.getShaderInfoLog(p).trim(),i=s.getShaderInfoLog(o).trim();let t=!0,e=!0;!1===s.getProgramParameter(u,s.LINK_STATUS)?(t=!1,Ce(s,p,"vertex"),Ce(s,o,"fragment")):""!==n||""!==a&&""!==i||(e=!1),e&&(this.diagnostics={runnable:t,programLog:n,vertexShader:{log:a,prefix:c},fragmentShader:{log:i,prefix:d}})}s.deleteShader(p),s.deleteShader(o);let f;this.getUniforms=function(){return void 0===f&&(f=new ze(s,u)),f};let m;return this.getAttributes=function(){return void 0===m&&(m=function(i,r){const s={};var t=i.getProgramParameter(r,i.ACTIVE_ATTRIBUTES);for(let e=0;e<t;e++){var n=i.getActiveAttrib(r,e),a=n.name;let t=1;n.type===i.FLOAT_MAT2&&(t=2),n.type===i.FLOAT_MAT3&&(t=3),n.type===i.FLOAT_MAT4&&(t=4),s[a]={type:n.type,location:i.getAttribLocation(r,a),locationSize:t}}return s}(s,u)),m},this.destroy=function(){r.releaseStatesOfProgram(this),s.deleteProgram(u),this.program=void 0},this.name=e.shaderName,this.id=Te++,this.cacheKey=t,this.usedTimes=1,this.program=u,this.vertexShader=p,this.fragmentShader=o,this}let Re=0;class Oe{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){var e=t.vertexShader,i=t.fragmentShader;const r=this._getShaderStage(e),s=this._getShaderStage(i),n=this._getShaderCacheForMaterial(t);return!1===n.has(r)&&(n.add(r),r.usedTimes++),!1===n.has(s)&&(n.add(s),s.usedTimes++),this}remove(t){for(const e of this.materialCache.get(t))e.usedTimes--,0===e.usedTimes&&this.shaderCache.delete(e);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;return!1===e.has(t)&&e.set(t,new Set),e.get(t)}_getShaderStage(t){const e=this.shaderCache;var i;return!1===e.has(t)&&(i=new Pe,e.set(t,i)),e.get(t)}}class Pe{constructor(){this.id=Re++,this.usedTimes=0}}function Ie(e,t,i,r,l,n,s){const u=new Oe,a=[],c=l.isWebGL2;l.floatVertexTextures,l.maxVertexUniforms;let d=l.precision;return{getParameters:function(t,e,i,r,s){var n,a;null!==t.precision&&(d=l.getMaxPrecision(t.precision),d,t.precision),n=t.vertexShader,a=t.fragmentShader,u.update(t);var o=u.getVertexShaderID(t),h=u.getFragmentShaderID(t);return{isWebGL2:c,shaderName:t.type,vertexShader:n,fragmentShader:a,defines:t.defines,customVertexShaderID:o,customFragmentShaderID:h,isRawShaderMaterial:!0===t.isRawShaderMaterial,glslVersion:t.glslVersion,precision:d,vertexColors:t.vertexColors,index0AttributeName:t.index0AttributeName}},getProgramCacheKey:function(t){const e=[];if(t.shaderID?e.push(t.shaderID):(e.push(t.customVertexShaderID),e.push(t.customFragmentShaderID)),void 0!==t.defines)for(const i in t.defines)e.push(i),e.push(t.defines[i]);return e.push(t.customProgramCacheKey),e.join()},getUniforms:function(t){return t.uniforms},acquireProgram:function(t,i){let r;for(let t=0,e=a.length;t<e;t++){var s=a[t];if(s.cacheKey===i){r=s,++r.usedTimes;break}}return void 0===r&&(r=new Le(e,i,t,n),a.push(r)),r},releaseProgram:function(t){var e;0==--t.usedTimes&&(e=a.indexOf(t),a[e]=a[a.length-1],a.pop(),t.destroy())},releaseShaderCache:function(t){u.remove(t)},programs:a,dispose:function(){u.dispose()}}}function We(){let r=new WeakMap;return{get:function(t){let e=r.get(t);return void 0===e&&(e={},r.set(t,e)),e},remove:function(t){r.delete(t)},update:function(t,e,i){r.get(t)[e]=i},dispose:function(){r=new WeakMap}}}function Be(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function De(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Ue(){const o=[];let h=0;const a=[],l=[],u=[];function c(t,e,i,r,s,n){let a=o[h];return void 0===a?(a={id:t.id,object:t,geometry:e,material:i,groupOrder:r,renderOrder:t.renderOrder,z:s,group:n},o[h]=a):(a.id=t.id,a.object=t,a.geometry=e,a.material=i,a.groupOrder=r,a.renderOrder=t.renderOrder,a.z=s,a.group=n),h++,a}return{opaque:a,transmissive:l,transparent:u,init:function(){h=0,a.length=0,l.length=0,u.length=0},push:function(t,e,i,r,s,n){n=c(t,e,i,r,s,n),(0<i.transmission?l:!0===i.transparent?u:a).push(n)},unshift:function(t,e,i,r,s,n){n=c(t,e,i,r,s,n),(0<i.transmission?l:!0===i.transparent?u:a).unshift(n)},finish:function(){for(let t=h,e=o.length;t<e;t++){const i=o[t];if(null===i.id)break;i.id=null,i.object=null,i.geometry=null,i.material=null,i.group=null}},sort:function(t,e){1<a.length&&a.sort(t||Be),1<l.length&&l.sort(e||De),1<u.length&&u.sort(e||De)}}}function Ne(){let r=new WeakMap;return{get:function(t,e){let i;return!1===r.has(t)?(i=new Ue,r.set(t,[i])):e>=r.get(t).length?(i=new Ue,r.get(t).push(i)):i=r.get(t)[e],i},dispose:function(){r=new WeakMap}}}function ke(t,e){const i={ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let t=0;t<9;t++)i.probe.push(new Ct);return{setup:function(t,e){},setupView:function(t,e){},state:i}}function Ve(t,e){const i=new ke,r=[],s=[];return{init:function(){r.length=0,s.length=0},state:{lightsArray:r,shadowsArray:s,lights:i},setupLights:function(t){i.setup(r,t)},setupLightsView:function(t){i.setupView(r,t)},pushLight:function(t){r.push(t)},pushShadow:function(t){s.push(t)}}}function Xe(t,e){let r=new WeakMap;return{get:function(t,e=0){let i;return!1===r.has(t)?(i=new Ve,r.set(t,[i])):e>=r.get(t).length?(i=new Ve,r.get(t).push(i)):i=r.get(t)[e],i},dispose:function(){r=new WeakMap}}}function Ge(h,s,n){const i=n.isWebGL2;const r=new function(){let e=!1;const n=new zt;let i=null;const a=new zt(0,0,0,0);return{setMask:function(t){i===t||e||(h.colorMask(t,t,t,t),i=t)},setLocked:function(t){e=t},setClear:function(t,e,i,r,s){!0===s&&(t*=r,e*=r,i*=r),n.set(t,e,i,r),!1===a.equals(n)&&(h.clearColor(t,e,i,r),a.copy(n))},reset:function(){e=!1,i=null,a.set(-1,0,0,0)}}},a=new function(){let e=!1,i=null,r=null,s=null;return{setTest:function(t){(t?B:D)(h.DEPTH_TEST)},setMask:function(t){i===t||e||(h.depthMask(t),i=t)},setFunc:function(t){if(r!==t){if(t)switch(t){case ft:h.depthFunc(h.NEVER);break;case mt:h.depthFunc(h.ALWAYS);break;case xt:h.depthFunc(h.LESS);break;case yt:h.depthFunc(h.LEQUAL);break;case _t:h.depthFunc(h.EQUAL);break;case wt:h.depthFunc(h.GEQUAL);break;case bt:h.depthFunc(h.GREATER);break;case St:h.depthFunc(h.NOTEQUAL);break;default:h.depthFunc(h.LEQUAL)}else h.depthFunc(h.LEQUAL);r=t}},setLocked:function(t){e=t},setClear:function(t){s!==t&&(h.clearDepth(t),s=t)},reset:function(){e=!1,i=null,r=null,s=null}}};let e={},o={},l=new WeakMap,u=[],c=null,d=!1,p=null,f=null,m=null,x=null,y=null,g=null,v=null,M=!1,_=null,w=null,b=null,S=null,A=null;const z=h.getParameter(h.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let E=!1,t=0;const T=h.getParameter(h.VERSION);-1!==T.indexOf("WebGL")?(t=parseFloat(/^WebGL (\d)/.exec(T)[1]),E=1<=t):-1!==T.indexOf("OpenGL ES")&&(t=parseFloat(/^OpenGL ES (\d)/.exec(T)[1]),E=2<=t);let C=null,F={};var L=h.getParameter(h.SCISSOR_BOX),R=h.getParameter(h.VIEWPORT);const O=(new zt).fromArray(L),P=(new zt).fromArray(R);function I(t,e,i){var r=new Uint8Array(4),s=h.createTexture();h.bindTexture(t,s),h.texParameteri(t,h.TEXTURE_MIN_FILTER,h.NEAREST),h.texParameteri(t,h.TEXTURE_MAG_FILTER,h.NEAREST);for(let t=0;t<i;t++)h.texImage2D(e+t,0,h.RGBA,1,1,0,h.RGBA,h.UNSIGNED_BYTE,r);return s}const W={};function B(t){!0!==e[t]&&(h.enable(t),e[t]=!0)}function D(t){!1!==e[t]&&(h.disable(t),e[t]=!1)}W[h.TEXTURE_2D]=I(h.TEXTURE_2D,h.TEXTURE_2D,1),W[h.TEXTURE_CUBE_MAP]=I(h.TEXTURE_CUBE_MAP,h.TEXTURE_CUBE_MAP_POSITIVE_X,6),r.setClear(0,0,0,1),a.setClear(1),B(h.DEPTH_TEST),a.setFunc(yt),V(!1),X(j),B(h.CULL_FACE),k(H);const U={[J]:h.FUNC_ADD,[$]:h.FUNC_SUBTRACT,[tt]:h.FUNC_REVERSE_SUBTRACT};i?(U[et]=h.MIN,U[it]=h.MAX):null!==(R=s.get("EXT_blend_minmax"))&&(U[et]=R.MIN_EXT,U[it]=R.MAX_EXT);const N={[rt]:h.ZERO,[st]:h.ONE,[nt]:h.SRC_COLOR,[ot]:h.SRC_ALPHA,[pt]:h.SRC_ALPHA_SATURATE,[ct]:h.DST_COLOR,[lt]:h.DST_ALPHA,[at]:h.ONE_MINUS_SRC_COLOR,[ht]:h.ONE_MINUS_SRC_ALPHA,[dt]:h.ONE_MINUS_DST_COLOR,[ut]:h.ONE_MINUS_DST_ALPHA};function k(t,e,i,r,s,n,a,o){t!==H?(!1===d&&(B(h.BLEND),d=!0),t===K?(s=s||e,n=n||i,a=a||r,e===f&&s===y||(h.blendEquationSeparate(U[e],U[s]),f=e,y=s),i===m&&r===x&&n===g&&a===v||(h.blendFuncSeparate(N[i],N[r],N[n],N[a]),m=i,x=r,g=n,v=a),p=t,M=null):t===p&&o===M||(f===J&&y===J||(h.blendEquation(h.FUNC_ADD),f=J,y=J),o?t===Q&&h.blendFuncSeparate(h.ONE,h.ONE_MINUS_SRC_ALPHA,h.ONE,h.ONE_MINUS_SRC_ALPHA):t===Q&&h.blendFuncSeparate(h.SRC_ALPHA,h.ONE_MINUS_SRC_ALPHA,h.ONE,h.ONE_MINUS_SRC_ALPHA),m=null,x=null,g=null,v=null,p=t,M=o)):!0===d&&(D(h.BLEND),d=!1)}function V(t){_!==t&&(t?h.frontFace(h.CW):h.frontFace(h.CCW),_=t)}function X(t){t!==q?(B(h.CULL_FACE),t!==w&&(t===j?h.cullFace(h.BACK):t===Z?h.cullFace(h.FRONT):h.cullFace(h.FRONT_AND_BACK))):D(h.CULL_FACE),w=t}function G(t,e,i){t?(B(h.POLYGON_OFFSET_FILL),S===e&&A===i||(h.polygonOffset(e,i),S=e,A=i)):D(h.POLYGON_OFFSET_FILL)}function Y(t){void 0===t&&(t=h.TEXTURE0+z-1),C!==t&&(h.activeTexture(t),C=t)}return{buffers:{color:r,depth:a},enable:B,disable:D,bindFramebuffer:function(t,e){return o[t]!==e&&(h.bindFramebuffer(t,e),o[t]=e,i&&(t===h.DRAW_FRAMEBUFFER&&(o[h.FRAMEBUFFER]=e),t===h.FRAMEBUFFER&&(o[h.DRAW_FRAMEBUFFER]=e)),!0)},drawBuffers:function(i,t){let r=u,e=!1;if(i)if(r=l.get(t),void 0===r&&(r=[],l.set(t,r)),i.isWebGLMultipleRenderTargets){i=i.texture;if(r.length!==i.length||r[0]!==h.COLOR_ATTACHMENT0){for(let t=0,e=i.length;t<e;t++)r[t]=h.COLOR_ATTACHMENT0+t;r.length=i.length,e=!0}}else r[0]!==h.COLOR_ATTACHMENT0&&(r[0]=h.COLOR_ATTACHMENT0,e=!0);else r[0]!==h.BACK&&(r[0]=h.BACK,e=!0);e&&(n.isWebGL2?h.drawBuffers(r):s.get("WEBGL_draw_buffers").drawBuffersWEBGL(r))},useProgram:function(t){return c!==t&&(h.useProgram(t),c=t,!0)},setBlending:k,setMaterial:function(t,e){(t.side===Mt?D:B)(h.CULL_FACE);let i=t.side===vt;e&&(i=!i),V(i),t.blending===Q&&!1===t.transparent?k(H):k(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),a.setFunc(t.depthFunc),a.setTest(t.depthTest),a.setMask(t.depthWrite),r.setMask(t.colorWrite),G(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),(!0===t.alphaToCoverage?B:D)(h.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:V,setCullFace:X,setLineWidth:function(t){t!==b&&(E&&h.lineWidth(t),b=t)},setPolygonOffset:G,setScissorTest:function(t){(t?B:D)(h.SCISSOR_TEST)},activeTexture:Y,bindTexture:function(t,e){null===C&&Y();let i=F[C];void 0===i&&(i={type:void 0,texture:void 0},F[C]=i),i.type===t&&i.texture===e||(h.bindTexture(t,e||W[t]),i.type=t,i.texture=e)},unbindTexture:function(){const t=F[C];void 0!==t&&void 0!==t.type&&(h.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{h.compressedTexImage2D.apply(h,arguments)}catch(t){}},texImage2D:function(){try{h.texImage2D.apply(h,arguments)}catch(t){}},texImage3D:function(){try{h.texImage3D.apply(h,arguments)}catch(t){}},texStorage2D:function(){try{h.texStorage2D.apply(h,arguments)}catch(t){}},texStorage3D:function(){try{h.texStorage3D.apply(h,arguments)}catch(t){}},texSubImage2D:function(){try{h.texSubImage2D.apply(h,arguments)}catch(t){}},texSubImage3D:function(){try{h.texSubImage3D.apply(h,arguments)}catch(t){}},compressedTexSubImage2D:function(){try{h.compressedTexSubImage2D.apply(h,arguments)}catch(t){}},scissor:function(t){!1===O.equals(t)&&(h.scissor(t.x,t.y,t.z,t.w),O.copy(t))},viewport:function(t){!1===P.equals(t)&&(h.viewport(t.x,t.y,t.z,t.w),P.copy(t))},reset:function(){h.disable(h.BLEND),h.disable(h.CULL_FACE),h.disable(h.DEPTH_TEST),h.disable(h.POLYGON_OFFSET_FILL),h.disable(h.SCISSOR_TEST),h.disable(h.STENCIL_TEST),h.disable(h.SAMPLE_ALPHA_TO_COVERAGE),h.blendEquation(h.FUNC_ADD),h.blendFunc(h.ONE,h.ZERO),h.blendFuncSeparate(h.ONE,h.ZERO,h.ONE,h.ZERO),h.colorMask(!0,!0,!0,!0),h.clearColor(0,0,0,0),h.depthMask(!0),h.depthFunc(h.LESS),h.clearDepth(1),h.stencilMask(4294967295),h.stencilFunc(h.ALWAYS,0,4294967295),h.stencilOp(h.KEEP,h.KEEP,h.KEEP),h.clearStencil(0),h.cullFace(h.BACK),h.frontFace(h.CCW),h.polygonOffset(0,0),h.activeTexture(h.TEXTURE0),h.bindFramebuffer(h.FRAMEBUFFER,null),!0===i&&(h.bindFramebuffer(h.DRAW_FRAMEBUFFER,null),h.bindFramebuffer(h.READ_FRAMEBUFFER,null)),h.useProgram(null),h.lineWidth(1),h.scissor(0,0,h.canvas.width,h.canvas.height),h.viewport(0,0,h.canvas.width,h.canvas.height),e={},C=null,F={},o={},l=new WeakMap,u=[],c=null,d=!1,p=null,f=null,m=null,x=null,y=null,g=null,v=null,M=!1,_=null,w=null,b=null,S=null,A=null,O.set(0,0,h.canvas.width,h.canvas.height),P.set(0,0,h.canvas.width,h.canvas.height),r.reset(),a.reset()}}}function Ye(){const t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return t.style.display="block",t}function qe(t={}){const s=void 0!==t.canvas?t.canvas:Ye(),e=void 0!==t.context?t.context:null,i=void 0!==t.alpha&&t.alpha,r=void 0===t.depth||t.depth,n=void 0===t.stencil||t.stencil,a=void 0!==t.antialias&&t.antialias,o=void 0===t.premultipliedAlpha||t.premultipliedAlpha,h=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,l=void 0!==t.powerPreference?t.powerPreference:"default",u=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat;let f=null,_=null;const c=[],d=[];this.domElement=s,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=3e3,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const w=this;let p=!1,m=0,x=0,b=null,S=-1,A=null;const y=new zt,g=new zt;let v=s.width,M=s.height,z=1,E=null,T=null;const C=new zt(0,0,v,M),F=new zt(0,0,v,M);let L=!1,R=!1,O=!1,P=null;const I=new Ft,W=new Ct,B={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function D(){return null===b?z:1}let U=e;function N(e,i){for(let t=0;t<e.length;t++){var r=e[t],r=s.getContext(r,i);if(null!==r)return r}return null}try{var k={alpha:!0,depth:r,stencil:n,antialias:a,premultipliedAlpha:o,preserveDrawingBuffer:h,powerPreference:l,failIfMajorPerformanceCaveat:u};if("setAttribute"in s&&s.setAttribute("data-engine","three.js r"+gt),s.addEventListener("webglcontextlost",ht,!1),s.addEventListener("webglcontextrestored",lt,!1),null===U){const yt=["webgl2","webgl","experimental-webgl"];if(!0===w.isWebGL1Renderer&&yt.shift(),U=N(yt,k),null===U)throw N(yt),new Error("")}void 0===U.getShaderPrecisionFormat&&(U.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw t}let V,X,G,Y,q,j,Z,H,Q,K,J,$,tt,et,it,rt,st,nt,at;function ot(){V=new Dt(U),X=new Wt(U,V,t),V.init(X),G=new Ge(U,V,X),Y=new kt(U),q=new We,j={get:function(){}},Z=void 0,H=new Rt(U,X),at=new Pt(U,V,H,X),Q=new Ut(U,H,Y,at),K=new Vt(U,Q,H,Y),et=new Bt(q),J=new Ie(w,j,Z,V,X,at,et),$=new Ne,tt=new Xe(V,X),it=new Ot(w,j,G,K,i,o),rt=new It(U,V,Y,X),st=new Nt(U,V,Y,X),Y.programs=J.programs,w.capabilities=X,w.extensions=V,w.properties=q,w.renderLists=$,w.state=G,w.info=Y}function ht(t){t.preventDefault(),p=!0}function lt(){p=!1;var t=Y.autoReset;ot(),Y.autoReset=t}function ut(t){const e=t.target;e.removeEventListener("dispose",ut),function(t){const e=q.get(t).programs;void 0!==e&&(e.forEach(function(t){J.releaseProgram(t)}),t.isShaderMaterial&&J.releaseShaderCache(t))}(t=e),q.remove(t)}ot(),this.getContext=function(){return U},this.getContextAttributes=function(){return U.getContextAttributes()},this.forceContextLoss=function(){const t=V.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=V.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return z},this.setPixelRatio=function(t){void 0!==t&&(z=t,this.setSize(v,M,!1))},this.getSize=function(t){return t.set(v,M)},this.setSize=function(t,e,i){v=t,M=e,s.width=Math.floor(t*z),s.height=Math.floor(e*z),!1!==i&&(s.style.width=t+"px",s.style.height=e+"px"),this.setViewport(0,0,t,e)},this.getDrawingBufferSize=function(t){return t.set(v*z,M*z).floor()},this.setDrawingBufferSize=function(t,e,i){v=t,M=e,z=i,s.width=Math.floor(t*i),s.height=Math.floor(e*i),this.setViewport(0,0,t,e)},this.getCurrentViewport=function(t){return t.copy(y)},this.getViewport=function(t){return t.copy(C)},this.setViewport=function(t,e,i,r){t.isVector4?C.set(t.x,t.y,t.z,t.w):C.set(t,e,i,r),G.viewport(y.copy(C).multiplyScalar(z).floor())},this.getScissor=function(t){return t.copy(F)},this.setScissor=function(t,e,i,r){t.isVector4?F.set(t.x,t.y,t.z,t.w):F.set(t,e,i,r),G.scissor(g.copy(F).multiplyScalar(z).floor())},this.getScissorTest=function(){return L},this.setScissorTest=function(t){G.setScissorTest(L=t)},this.setOpaqueSort=function(t){E=t},this.setTransparentSort=function(t){T=t},this.getClearColor=function(t){return t.copy(it.getClearColor())},this.setClearColor=function(){it.setClearColor.apply(it,arguments)},this.getClearAlpha=function(){return it.getClearAlpha()},this.setClearAlpha=function(){it.setClearAlpha.apply(it,arguments)},this.clear=function(t,e,i){let r=0;void 0!==t&&!t||(r|=U.COLOR_BUFFER_BIT),void 0!==e&&!e||(r|=U.DEPTH_BUFFER_BIT),void 0!==i&&!i||(r|=U.STENCIL_BUFFER_BIT),U.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){s.removeEventListener("webglcontextlost",ht,!1),s.removeEventListener("webglcontextrestored",lt,!1),$.dispose(),tt.dispose(),q.dispose(),j.dispose(),Z.dispose(),K.dispose(),at.dispose(),J.dispose(),P&&(P.dispose(),P=null),dt.stop()},this.renderBufferDirect=function(t,e,i,r,s,n){null===e&&(e=B);var a=s.isMesh&&s.matrixWorld.determinant()<0,o=function(t,e,i,r,s){!0!==e.isScene&&(e=B);const n=r.isMeshStandardMaterial?e.environment:null,a=null===b?w.outputEncoding:!0===b.isXRRenderTarget?b.texture.encoding:3e3,o=(r.isMeshStandardMaterial?Z:j).get(r.envMap||n),h=!0===r.vertexColors&&!!i.attributes.color&&4===i.attributes.color.itemSize,l=!!r.normalMap&&!!i.attributes.tangent,u=!!i.morphAttributes.position,c=!!i.morphAttributes.normal,d=i.morphAttributes.position?i.morphAttributes.position.length:0,p=r.toneMapped?w.toneMapping:0,f=q.get(r),m=_.state.lights;!0===R&&(!0!==O&&t===A||(i=t===A&&r.id===S,et.setState(r,t,i)));let x=!1;r.version===f.__version?(f.needsLights&&f.lightsStateVersion!==m.state.version||f.outputEncoding!==a||f.envMap!==o||void 0!==f.numClippingPlanes&&(f.numClippingPlanes!==et.numPlanes||f.numIntersection!==et.numIntersection)||f.vertexAlphas!==h||f.vertexTangents!==l||f.morphTargets!==u||f.morphNormals!==c||f.toneMapping!==p||!0===X.isWebGL2&&f.morphTargetsCount!==d)&&(x=!0):(x=!0,f.__version=r.version);let y=f.currentProgram;!0===x&&(y=mt(r,e,s));let g=!1;const v=y.getUniforms();f.uniforms;G.useProgram(y.program)&&(g=!0);r.id!==S&&(S=r.id);if(g||A!==t){if(v.setValue(U,"projectionMatrix",t.projectionMatrix),X.logarithmicDepthBuffer&&v.setValue(U,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),A!==t&&(A=t),r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshStandardMaterial||r.envMap){const M=v.map.cameraPosition;void 0!==M&&M.setValue(U,W.setFromMatrixPosition(t.matrixWorld))}(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.isShadowMaterial||s.isSkinnedMesh)&&v.setValue(U,"viewMatrix",t.matrixWorldInverse)}return v.setValue(U,"modelViewMatrix",s.modelViewMatrix),v.setValue(U,"normalMatrix",s.normalMatrix),v.setValue(U,"modelMatrix",s.matrixWorld),y}(t,e,i,r,s);G.setMaterial(r,a);let h=i.index;t=i.attributes.position;if(null===h){if(void 0===t||0===t.count)return}else if(0===h.count)return;let l=1;!0===r.wireframe&&(h=Q.getWireframeAttribute(i),l=2),at.setup(s,r,o,i,h);let u=rt;null!==h&&(c=H.get(h),u=st,u.setIndex(c));var e=(null!==h?h:t).count,a=i.drawRange.start*l,o=i.drawRange.count*l,c=null!==n?n.start*l:0,t=null!==n?n.count*l:1/0,n=Math.max(a,c),t=Math.min(e,a+o,c+t)-1,t=Math.max(0,t-n+1);if(0!==t){if(s.isMesh)!0===r.wireframe?(G.setLineWidth(r.wireframeLinewidth*D()),u.setMode(U.LINES)):u.setMode(U.TRIANGLES);else if(s.isLine){let t=r.linewidth;void 0===t&&(t=1),G.setLineWidth(t*D()),s.isLineSegments?u.setMode(U.LINES):s.isLineLoop?u.setMode(U.LINE_LOOP):u.setMode(U.LINE_STRIP)}else s.isPoints?u.setMode(U.POINTS):s.isSprite&&u.setMode(U.TRIANGLES);i.isInstancedBufferGeometry?(i=Math.min(i.instanceCount,i._maxInstanceCount),u.renderInstances(n,t,i)):u.render(n,t)}},this.compile=function(r,e){_=tt.get(r),_.init(),d.push(_),r.traverseVisible(function(t){t.isLight&&t.layers.test(e.layers)&&(_.pushLight(t),t.castShadow&&_.pushShadow(t))}),_.setupLights(w.physicallyCorrectLights),r.traverse(function(e){var i=e.material;if(i)if(Array.isArray(i))for(let t=0;t<i.length;t++)mt(i[t],r,e);else mt(i,r,e)}),d.pop(),_=null};let ct=null;const dt=new Lt;function pt(t,e,i,r){var s=t.opaque,n=t.transmissive,t=t.transparent;_.setupLightsView(i),0<n.length&&function(t,e,i){if(null===P){const n=!0===a&&!0===X.isWebGL2?Tt:Et;P=new n(1024,1024,{generateMipmaps:!0,type:null!==nt.convert(1016)?1016:1009,minFilter:1008,magFilter:1003,wrapS:At,wrapT:At,useRenderToTexture:V.has("WEBGL_multisampled_render_to_texture")})}var r=w.getRenderTarget();w.setRenderTarget(P),w.clear();var s=w.toneMapping;w.toneMapping=0,ft(t,e,i),w.toneMapping=s,w.setRenderTarget(r)}(s,e,i),r&&G.viewport(y.copy(r)),0<s.length&&ft(s,e,i),0<n.length&&ft(n,e,i),0<t.length&&ft(t,e,i)}function ft(i,r,s){var n=!0===r.isScene?r.overrideMaterial:null;for(let t=0,e=i.length;t<e;t++){var a=i[t];const l=a.object;var o=a.geometry,h=null===n?a.material:n,a=a.group;l.layers.test(s.layers)&&function(t,e,i,r,s,n){t.onBeforeRender(w,e,i,r,s,n),t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),s.onBeforeRender(w,e,i,r,t,n),!0===s.transparent&&s.side===Mt?(s.side=vt,s.needsUpdate=!0,w.renderBufferDirect(i,e,r,s,t,n),s.side=0,s.needsUpdate=!0,w.renderBufferDirect(i,e,r,s,t,n),s.side=Mt):w.renderBufferDirect(i,e,r,s,t,n);t.onAfterRender(w,e,i,r,s,n)}(l,r,s,o,h,a)}}function mt(t,e,i){!0!==e.isScene&&(e=B);const r=q.get(t);var s=_.state.lights,n=_.state.shadowsArray,a=s.state.version;const o=J.getParameters(t,s.state,n,e,i);n=J.getProgramCacheKey(o);let h=r.programs;r.environment=t.isMeshStandardMaterial?e.environment:null,r.envMap=(t.isMeshStandardMaterial?Z:j).get(t.envMap||r.environment),void 0===h&&(t.addEventListener("dispose",ut),h=new Map,r.programs=h);let l=h.get(n);if(void 0!==l){if(r.currentProgram===l&&r.lightsStateVersion===a)return xt(t,o),l}else o.uniforms=J.getUniforms(t),t.onBuild(i,o,w),t.onBeforeCompile(o,w),l=J.acquireProgram(o,n),h.set(n,l),r.uniforms=o.uniforms;const u=r.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(u.clippingPlanes=et.uniform),xt(t,o),r.needsLights=!1,r.lightsStateVersion=a,r.needsLights&&(u.ambientLightColor.value=s.state.ambient,u.lightProbe.value=s.state.probe,u.directionalLights.value=s.state.directional,u.directionalLightShadows.value=s.state.directionalShadow,u.spotLights.value=s.state.spot,u.spotLightShadows.value=s.state.spotShadow,u.rectAreaLights.value=s.state.rectArea,u.ltc_1.value=s.state.rectAreaLTC1,u.ltc_2.value=s.state.rectAreaLTC2,u.pointLights.value=s.state.point,u.pointLightShadows.value=s.state.pointShadow,u.hemisphereLights.value=s.state.hemi,u.directionalShadowMap.value=s.state.directionalShadowMap,u.directionalShadowMatrix.value=s.state.directionalShadowMatrix,u.spotShadowMap.value=s.state.spotShadowMap,u.spotShadowMatrix.value=s.state.spotShadowMatrix,u.pointShadowMap.value=s.state.pointShadowMap,u.pointShadowMatrix.value=s.state.pointShadowMatrix);s=l.getUniforms(),s=ze.seqWithValue(s.seq,u);return r.currentProgram=l,r.uniformsList=s,l}function xt(t,e){const i=q.get(t);i.outputEncoding=e.outputEncoding,i.instancing=e.instancing,i.numClippingPlanes=e.numClippingPlanes,i.numIntersection=e.numClipIntersection,i.vertexAlphas=e.vertexAlphas,i.vertexTangents=e.vertexTangents,i.toneMapping=e.toneMapping}dt.setAnimationLoop(function(t){ct&&ct(t)}),"undefined"!=typeof window&&dt.setContext(window),this.setAnimationLoop=function(t){null===(ct=t)?dt.stop():dt.start()},this.render=function(i,t){if((void 0===t||!0===t.isCamera)&&!0!==p){!0===i.autoUpdate&&i.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===i.isScene&&i.onBeforeRender(w,i,t,b),_=tt.get(i,d.length),_.init(),d.push(_),I.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),O=this.localClippingEnabled,R=et.init(this.clippingPlanes,O,t),f=$.get(i,c.length),f.init(),c.push(f),function i(r,s,n,a){if(!1===r.visible)return;const t=r.layers.test(s.layers);if(t)if(r.isGroup)n=r.renderOrder;else if(r.isLOD)!0===r.autoUpdate&&r.update(s);else if(r.isLight)_.pushLight(r),r.castShadow&&_.pushShadow(r);else if(r.isSprite){if(!r.frustumCulled||_frustum.intersectsSprite(r)){a&&W.setFromMatrixPosition(r.matrixWorld).applyMatrix4(I);const e=K.update(r),h=r.material;h.visible&&f.push(r,e,h,n,W.z,null)}}else if(r.isMesh||r.isLine||r.isPoints){a&&W.setFromMatrixPosition(r.matrixWorld).applyMatrix4(I);const l=K.update(r),u=r.material;if(Array.isArray(u)){const c=l.groups;for(let t=0,e=c.length;t<e;t++){const d=c[t],p=u[d.materialIndex];p&&p.visible&&f.push(r,l,p,n,W.z,d)}}else u.visible&&f.push(r,l,u,n,W.z,null)}const o=r.children;for(let t=0,e=o.length;t<e;t++)i(o[t],s,n,a)}(i,t,0,w.sortObjects),f.finish(),!0===w.sortObjects&&f.sort(E,T),!0===R&&et.beginShadows();_.state.shadowsArray;if(!0===R&&et.endShadows(),!0===this.info.autoReset&&this.info.reset(),it.render(f,i),_.setupLights(w.physicallyCorrectLights),t.isArrayCamera){var r=t.cameras;for(let t=0,e=r.length;t<e;t++){var s=r[t];pt(f,i,s,s.viewport)}}else pt(f,i,t);!0===i.isScene&&i.onAfterRender(w,i,t),G.buffers.depth.setTest(!0),G.buffers.depth.setMask(!0),G.buffers.color.setMask(!0),G.setPolygonOffset(!1),at.resetDefaultState(),S=-1,A=null,d.pop(),_=0<d.length?d[d.length-1]:null,c.pop(),f=0<c.length?c[c.length-1]:null}},this.getActiveCubeFace=function(){return m},this.getActiveMipmapLevel=function(){return x},this.getRenderTarget=function(){return b},this.initTexture=function(t){G.unbindTexture()},this.resetState=function(){m=0,x=0,b=null,G.reset(),at.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}qe.prototype.isWebGLRenderer=!0;(class extends qe{}).prototype.isWebGL1Renderer=!0;const je=new Ft,Ze=new s;class He{constructor(t=0,e=0,i=0,r=He.DefaultOrder){this._x=t,this._y=e,this._z=i,this._order=r}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,r=this._order){return this._x=t,this._y=e,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){var t=t.elements,r=t[0],s=t[4],n=t[8],a=t[1],o=t[5],h=t[9],l=t[2],u=t[6],c=t[10];switch(e){case"XYZ":this._y=Math.asin(d(n,-1,1)),Math.abs(n)<.9999999?(this._x=Math.atan2(-h,c),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(u,o),this._z=0);break;case"YXZ":this._x=Math.asin(-d(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(n,c),this._z=Math.atan2(a,o)):(this._y=Math.atan2(-l,r),this._z=0);break;case"ZXY":this._x=Math.asin(d(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-l,c),this._z=Math.atan2(-s,o)):(this._y=0,this._z=Math.atan2(a,r));break;case"ZYX":this._y=Math.asin(-d(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(u,c),this._z=Math.atan2(a,r)):(this._x=0,this._z=Math.atan2(-s,o));break;case"YZX":this._z=Math.asin(d(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-h,o),this._y=Math.atan2(-l,r)):(this._x=0,this._y=Math.atan2(n,c));break;case"XZY":this._z=Math.asin(-d(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(u,o),this._y=Math.atan2(n,r)):(this._x=Math.atan2(-h,c),this._y=0)}return this._order=e,!0===i&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return je.makeRotationFromQuaternion(t),this.setFromRotationMatrix(je,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return Ze.setFromEuler(this),this.setFromQuaternion(Ze,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}toVector3(t){return t?t.set(this._x,this._y,this._z):new Ct(this._x,this._y,this._z)}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}He.prototype.isEuler=!0,He.DefaultOrder="XYZ",He.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];let Qe=0;const Ke=new Ct,Je=new s,$e=new Ft,ti=new Ct,ei=new Ct,ii=new Ct,ri=new s,si=new Ct(1,0,0),ni=new Ct(0,1,0),ai=new Ct(0,0,1),oi={type:"added"},hi={type:"removed"};class li extends e{constructor(){super(),Object.defineProperty(this,"id",{value:Qe++}),this.uuid=u(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=li.DefaultUp.clone();var t=new Ct;const e=new He,i=new s;var r=new Ct(1,1,1);e._onChange(function(){i.setFromEuler(e,!1)}),i._onChange(function(){e.setFromQuaternion(i,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Ft},normalMatrix:{value:new y}}),this.matrix=new Ft,this.matrixWorld=new Ft,this.matrixAutoUpdate=li.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new L,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return Je.setFromAxisAngle(t,e),this.quaternion.multiply(Je),this}rotateOnWorldAxis(t,e){return Je.setFromAxisAngle(t,e),this.quaternion.premultiply(Je),this}rotateX(t){return this.rotateOnAxis(si,t)}rotateY(t){return this.rotateOnAxis(ni,t)}rotateZ(t){return this.rotateOnAxis(ai,t)}translateOnAxis(t,e){return Ke.copy(t).applyQuaternion(this.quaternion),this.position.add(Ke.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(si,t)}translateY(t){return this.translateOnAxis(ni,t)}translateZ(t){return this.translateOnAxis(ai,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4($e.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?ti.copy(t):ti.set(t,e,i);i=this.parent;this.updateWorldMatrix(!0,!1),ei.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?$e.lookAt(ei,ti,this.up):$e.lookAt(ti,ei,this.up),this.quaternion.setFromRotationMatrix($e),i&&($e.extractRotation(i.matrixWorld),Je.setFromRotationMatrix($e),this.quaternion.premultiply(Je.invert()))}add(t){if(1<arguments.length){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this||t&&t.isObject3D&&(null!==t.parent&&t.parent.remove(t),(t.parent=this).children.push(t),t.dispatchEvent(oi)),this}remove(t){if(1<arguments.length){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(hi)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(hi)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),$e.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),$e.multiply(t.parent.matrixWorld)),t.applyMatrix4($e),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(i,r){if(this[i]===r)return this;for(let t=0,e=this.children.length;t<e;t++){const n=this.children[t];var s=n.getObjectByProperty(i,r);if(void 0!==s)return s}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ei,t,ii),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ei,ri,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);var e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(i){i(this);const r=this.children;for(let t=0,e=r.length;t<e;t++)r[t].traverse(i)}traverseVisible(i){if(!1!==this.visible){i(this);const r=this.children;for(let t=0,e=r.length;t<e;t++)r[t].traverseVisible(i)}}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(i){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||i)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),i=!(this.matrixWorldNeedsUpdate=!1));const r=this.children;for(let t=0,e=r.length;t<e;t++)r[t].updateMatrixWorld(i)}updateWorldMatrix(t,e){const i=this.parent;if(!0===t&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const r=this.children;for(let t=0,e=r.length;t<e;t++)r[t].updateWorldMatrix(!1,!0)}}}li.DefaultUp=new Ct(0,1,0),li.DefaultMatrixAutoUpdate=!0,li.prototype.isObject3D=!0;class ui extends li{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}}ui.prototype.isScene=!0;let ci=0;const di=new Ft,pi=new li,fi=new Ct,mi=new Ct;class xi extends e{constructor(){super(),Object.defineProperty(this,"id",{value:ci++}),this.uuid=u(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(65535<F(t)?E:z)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,i=0){this.groups.push({start:t,count:e,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const i=this.attributes.normal;var r;void 0!==i&&(r=(new y).getNormalMatrix(t),i.applyNormalMatrix(r),i.needsUpdate=!0);const s=this.attributes.tangent;return void 0!==s&&(s.transformDirection(t),s.needsUpdate=!0),this}applyQuaternion(t){return di.makeRotationFromQuaternion(t),this.applyMatrix4(di),this}rotateX(t){return di.makeRotationX(t),this.applyMatrix4(di),this}rotateY(t){return di.makeRotationY(t),this.applyMatrix4(di),this}rotateZ(t){return di.makeRotationZ(t),this.applyMatrix4(di),this}translate(t,e,i){return di.makeTranslation(t,e,i),this.applyMatrix4(di),this}scale(t,e,i){return di.makeScale(t,e,i),this.applyMatrix4(di),this}lookAt(t){return pi.lookAt(t),pi.updateMatrix(),this.applyMatrix4(pi.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(fi).negate(),this.translate(fi.x,fi.y,fi.z),this}setFromPoints(i){const r=[];for(let t=0,e=i.length;t<e;t++){var s=i[t];r.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new P(r,3)),this}computeTangents(){var t=this.index,e=this.attributes;if(null!==t&&void 0!==e.position&&void 0!==e.normal&&void 0!==e.uv){var r=t.array;const u=e.position.array,c=e.normal.array,d=e.uv.array;var s=u.length/3;void 0===e.tangent&&this.setAttribute("tangent",new C(new Float32Array(4*s),4));const p=e.tangent.array,f=[],m=[];for(let t=0;t<s;t++)f[t]=new Ct,m[t]=new Ct;const x=new Ct,y=new Ct,g=new Ct,v=new T,M=new T,_=new T,w=new Ct,b=new Ct;let i=this.groups;0===i.length&&(i=[{start:0,count:r.length}]);for(let t=0,e=i.length;t<e;++t){var n=i[t],a=n.start;for(let t=a,e=a+n.count;t<e;t+=3)!function(t,e,i){x.fromArray(u,3*t),y.fromArray(u,3*e),g.fromArray(u,3*i),v.fromArray(d,2*t),M.fromArray(d,2*e),_.fromArray(d,2*i),y.sub(x),g.sub(x),M.sub(v),_.sub(v);var r=1/(M.x*_.y-_.x*M.y);isFinite(r)&&(w.copy(y).multiplyScalar(_.y).addScaledVector(g,-M.y).multiplyScalar(r),b.copy(g).multiplyScalar(M.x).addScaledVector(y,-_.x).multiplyScalar(r),f[t].add(w),f[e].add(w),f[i].add(w),m[t].add(b),m[e].add(b),m[i].add(b))}(r[t+0],r[t+1],r[t+2])}const S=new Ct,A=new Ct,z=new Ct,E=new Ct;for(let t=0,e=i.length;t<e;++t){var o=i[t],h=o.start;for(let t=h,e=h+o.count;t<e;t+=3)l(r[t+0]),l(r[t+1]),l(r[t+2])}function l(t){z.fromArray(c,3*t),E.copy(z);var e=f[t];S.copy(e),S.sub(z.multiplyScalar(z.dot(e))).normalize(),A.crossVectors(E,e);e=A.dot(m[t])<0?-1:1;p[4*t]=S.x,p[4*t+1]=S.y,p[4*t+2]=S.z,p[4*t+3]=e}}}computeVertexNormals(){const r=this.index;var s=this.getAttribute("position");if(void 0!==s){let i=this.getAttribute("normal");if(void 0===i)i=new C(new Float32Array(3*s.count),3),this.setAttribute("normal",i);else for(let t=0,e=i.count;t<e;t++)i.setXYZ(t,0,0,0);const h=new Ct,l=new Ct,u=new Ct,c=new Ct,d=new Ct,p=new Ct,f=new Ct,m=new Ct;if(r)for(let t=0,e=r.count;t<e;t+=3){var n=r.getX(t+0),a=r.getX(t+1),o=r.getX(t+2);h.fromBufferAttribute(s,n),l.fromBufferAttribute(s,a),u.fromBufferAttribute(s,o),f.subVectors(u,l),m.subVectors(h,l),f.cross(m),c.fromBufferAttribute(i,n),d.fromBufferAttribute(i,a),p.fromBufferAttribute(i,o),c.add(f),d.add(f),p.add(f),i.setXYZ(n,c.x,c.y,c.z),i.setXYZ(a,d.x,d.y,d.z),i.setXYZ(o,p.x,p.y,p.z)}else for(let t=0,e=s.count;t<e;t+=3)h.fromBufferAttribute(s,t+0),l.fromBufferAttribute(s,t+1),u.fromBufferAttribute(s,t+2),f.subVectors(u,l),m.subVectors(h,l),f.cross(m),i.setXYZ(t+0,f.x,f.y,f.z),i.setXYZ(t+1,f.x,f.y,f.z),i.setXYZ(t+2,f.x,f.y,f.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const i=this.attributes.normal;for(let t=0,e=i.count;t<e;t++)mi.fromBufferAttribute(i,t),mi.normalize(),i.setXYZ(t,mi.x,mi.y,mi.z)}toNonIndexed(){function i(i,r){const s=i.array;var n=i.itemSize,t=i.normalized;const a=new s.constructor(r.length*n);let o=0,h=0;for(let t=0,e=r.length;t<e;t++){o=i.isInterleavedBufferAttribute?r[t]*i.data.stride+i.offset:r[t]*n;for(let t=0;t<n;t++)a[h++]=s[o++]}return new C(a,n,t)}if(null===this.index)return this;const r=new xi;var s=this.index.array,t=this.attributes;for(const u in t){var e=i(t[u],s);r.setAttribute(u,e)}var n=this.morphAttributes;for(const c in n){const d=[];var a=n[c];for(let t=0,e=a.length;t<e;t++){var o=i(a[t],s);d.push(o)}r.morphAttributes[c]=d}r.morphTargetsRelative=this.morphTargetsRelative;var h=this.groups;for(let t=0,e=h.length;t<e;t++){var l=h[t];r.addGroup(l.start,l.count,l.materialIndex)}return r}dispose(){this.dispatchEvent({type:"dispose"})}}xi.prototype.isBufferGeometry=!0;class yi extends li{constructor(t=new xi,e){super(),this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){}}yi.prototype.isMesh=!0;(class extends li{});class gi extends xi{constructor(t=1,e=1,i=1,r=1,s=1,n=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:r,heightSegments:s,depthSegments:n};const E=this;r=Math.floor(r),s=Math.floor(s),n=Math.floor(n);const T=[],C=[],F=[],L=[];let R=0,O=0;function a(i,r,s,n,a,t,e,o,h,l,u){var c=t/h,d=e/l,p=t/2,f=e/2,m=o/2,x=h+1,y=l+1;let g=0,v=0;const M=new Ct;for(let e=0;e<y;e++){var _=e*d-f;for(let t=0;t<x;t++){var w=t*c-p;M[i]=w*n,M[r]=_*a,M[s]=m,C.push(M.x,M.y,M.z),M[i]=0,M[r]=0,M[s]=0<o?1:-1,F.push(M.x,M.y,M.z),L.push(t/h),L.push(1-e/l),g+=1}}for(let e=0;e<l;e++)for(let t=0;t<h;t++){var b=R+t+x*e,S=R+t+x*(e+1),A=R+(t+1)+x*(e+1),z=R+(t+1)+x*e;T.push(b,S,z),T.push(S,A,z),v+=6}E.addGroup(O,v,u),O+=v,R+=g}a("z","y","x",-1,-1,i,e,t,n,s,0),a("z","y","x",1,-1,i,e,-t,n,s,1),a("x","z","y",1,1,t,i,e,r,n,2),a("x","z","y",1,-1,t,i,-e,r,n,3),a("x","y","z",1,-1,t,e,i,r,s,4),a("x","y","z",-1,-1,t,e,-i,r,s,5),this.setIndex(T),this.setAttribute("position",new P(C,3)),this.setAttribute("normal",new P(F,3)),this.setAttribute("uv",new P(L,2))}static fromJSON(t){return new gi(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}class vi extends xi{constructor(t=1,e=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:r};var s=t/2,n=e/2,a=Math.floor(i),o=Math.floor(r),h=a+1,l=o+1,u=t/a,c=e/o;const d=[],p=[],f=[],m=[];for(let e=0;e<l;e++){var x=e*c-n;for(let t=0;t<h;t++){var y=t*u-s;p.push(y,-x,0),f.push(0,0,1),m.push(t/a),m.push(1-e/o)}}for(let e=0;e<o;e++)for(let t=0;t<a;t++){var g=t+h*e,v=t+h*(e+1),M=t+1+h*(e+1),_=t+1+h*e;d.push(g,v,_),d.push(v,M,_)}this.setIndex(d),this.setAttribute("position",new P(p,3)),this.setAttribute("normal",new P(f,3)),this.setAttribute("uv",new P(m,2))}static fromJSON(t){return new vi(t.width,t.height,t.widthSegments,t.heightSegments)}}let Mi=0;class _i extends e{constructor(){super(),Object.defineProperty(this,"id",{value:Mi++}),this.uuid=u(),this.name="",this.type="Material",this.fog=!0,this.blending=Q,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=ot,this.blendDst=ht,this.blendEquation=J,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=yt,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=t,this.stencilZFail=t,this.stencilZPass=t,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.alphaWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){0<this._alphaTest!=0<t&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const i in t){var e=t[i];if(void 0!==e)if("shading"!==i){const r=this[i];void 0!==r&&(r&&r.isColor?r.set(e):r&&r.isVector3&&e&&e.isVector3?r.copy(e):this[i]=e)}else this.flatShading=1===e}}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}}_i.prototype.isMaterial=!0;class wi extends _i{constructor(t){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);",this.fragmentShader="void main(){gl_FragColor=vec4(1.,0.,0.,1.);}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&(t.attributes,this.setValues(t))}}wi.prototype.isShaderMaterial=!0;class bi extends wi{constructor(t){super(t),this.type="RawShaderMaterial"}}bi.prototype.isRawShaderMaterial=!0;class Si extends li{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new Ft,this.projectionMatrix=new Ft,this.projectionMatrixInverse=new Ft}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);var e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}}Si.prototype.isCamera=!0;class Ai extends Si{constructor(t=50,e=1,i=.1,r=2e3){super(),this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}setFocalLength(t){t=.5*this.getFilmHeight()/t;this.fov=2*i*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){var t=Math.tan(.5*h*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*i*Math.atan(Math.tan(.5*h*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,i,r,s,n){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=n,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){var t=this.near;let e=t*Math.tan(.5*h*this.fov)/this.zoom,i=2*e,r=this.aspect*i,s=-.5*r;var n,a=this.view;null!==this.view&&this.view.enabled&&(n=a.fullWidth,o=a.fullHeight,s+=a.offsetX*r/n,e-=a.offsetY*i/o,r*=a.width/n,i*=a.height/o);var o=this.filmOffset;0!==o&&(s+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,e,e-i,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}}Ai.prototype.isPerspectiveCamera=!0;(class extends xi{});class zi{constructor(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=u()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copyAt(i,r,s){i*=this.stride,s*=r.stride;for(let t=0,e=this.stride;t<e;t++)this.array[i+t]=r.array[s+t];return this}set(t,e=0){return this.array.set(t,e),this}onUpload(t){return this.onUploadCallback=t,this}}zi.prototype.isInterleavedBuffer=!0;(class extends zi{constructor(t,e,i=1){super(t,e),this.meshPerAttribute=i}}).prototype.isInstancedInterleavedBuffer=!0;(class extends C{});"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:gt}})),"undefined"!=typeof window&&(window.__THREE__||(window.__THREE__=gt));const Ei={YELLOW:[255,255,100],ORANGE:[255,200,100],BLACK:[50,50,50],BLUE:[100,200,255]};new gi;const Ti=new bi({transparent:!1,uniforms:{},vertexShader:`
      uniform mat4 modelViewMatrix;
      uniform mat4 projectionMatrix;
      attribute vec3 position;
      attribute vec3 color;
      varying lowp vec3 vColor;
      varying float vHeight;
      varying float vDepth;
      void main() {
        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.);
        vColor = color;
        vHeight = gl_Position.y;
        vDepth = gl_Position.z;
      }`,fragmentShader:`
    precision highp float;
    varying lowp vec3 vColor;
    varying float vHeight;
    varying float vDepth;
    vec3 waterColor = vec3(0.48, 0.78, 1.);
    vec3 fogColor = vec3(240./255., 128./255., 1.);
  float getFogFactor(float d)
  {
    const float FogMax = 65.0;
    const float FogMin = 10.0;

    if (d>=FogMax) return 1.;
    if (d<=FogMin) return 0.;

    return 1. - (FogMax - d) / (FogMax - FogMin);
  } 

    void main(void) {

      vec3 color;
      
      if (vHeight < -6.4) {
        color = mix(vColor.rgb, waterColor, 0.65);
      } else {
        color = vec3(vColor.rgb);
      }

      float fog_alpha = getFogFactor(vDepth);
      color = mix(color, fogColor, fog_alpha);
      
      
      gl_FragColor= vec4(color, 1.0);
    }`});function Ci(t,e=1,i=1,r=1){t.position.x=e,t.position.y=i,t.position.z=r}function Fi(t,e=1,i=1,r=1){t.scale.x=e,t.scale.y=i,t.scale.z=r}function Li(e){const t=new gi;const i=[];for(let t=0;t<24;t++)for(let t=0;t<e.length;t++)i.push(e[t]/255);return t.setAttribute("color",new P(i,3)),new yi(t,Ti)}function Ri(){this.velocity={x:0,y:0},this.angle=0,this.root=new li;const i={},t={};i.head=new li,i.bill=new li,i.feet=new li,t.body=Li(Ei.YELLOW),t.head=Li(Ei.YELLOW),t.left_eye=Li(Ei.BLACK),t.right_eye=Li(Ei.BLACK),t.bill=Li(Ei.ORANGE),t.left_foot=Li(Ei.ORANGE),t.right_foot=Li(Ei.ORANGE),Ci(i.head,1,1,0),this.root.add(i.head),Ci(i.bill,.6,-.1,0),i.head.add(i.bill),Fi(t.body,1.75,1.35,1.25),this.root.add(t.body),Fi(t.head,1,1,1),i.head.add(t.head),Fi(t.left_eye,.15,.15,.15),Ci(t.left_eye,.5,.3,-.2),i.head.add(t.left_eye),Fi(t.right_eye,.15,.15,.15),Ci(t.right_eye,.5,.3,.2),i.head.add(t.right_eye),Fi(t.bill,.6,.4,.8),i.bill.add(t.bill),Ci(i.feet,-.2,-.7,0),this.root.add(i.feet),Ci(t.left_foot,0,0,.2),Fi(t.left_foot,.2,1,.6),i.feet.add(t.left_foot),Ci(t.right_foot,0,0,-.2),Fi(t.right_foot,1,.2,.6),i.feet.add(t.right_foot),this.root.rotateY(Math.PI*Math.random()),this.setPosition=function(t,e,i){this.root,this.root.position.x=t,this.root.position.y=e,this.root.position.z=i};const r=5e3*Math.random();this.update=()=>{var t=Date.now()+r;i.head.rotateX(Math.sin(t/200)/125),i.feet.rotateZ(Math.PI/-25);var e=new Ct;this.root.getWorldDirection(e),this.root.translateX(.1),this.root.rotateY(Math.PI/250),this.root.rotateZ(Math.sin(t/200)/400)}}!function(){const i=new ui,r=new Ai(75,window.innerWidth/window.innerHeight,.1,1e3),s=new qe({antialias:!0,canvas:document.getElementById("game_canvas"),alpha:!0});Ci(r,0,5,20),s.setClearColor([.48,.78,1],0);var t=()=>{var t=window.innerWidth,e=window.innerHeight;r.aspect=t/e,r.updateProjectionMatrix(),s.setSize(t,e)};t(),window.addEventListener("resize",t);const n=[];for(let t=0;t<10;t++){const e=new Ri;e.setPosition(20*Math.random()-10,.25,10*Math.random()-5),i.add(e.root),n.push(e)}new vi(200,200),function t(){requestAnimationFrame(t);for(const e of n)e.update();s.render(i,r)}()}()}();
